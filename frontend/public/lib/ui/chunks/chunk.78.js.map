{"version":3,"sources":["webpack:///./src/ui/src/components/ScaleModal/ScaleModal.scss?4f23","webpack:///./src/ui/src/components/ScaleModal/ScaleCustom.js","webpack:///./src/ui/src/components/ScaleModal/ScaleModal.js","webpack:///./src/ui/src/components/ScaleModal/index.js"],"names":["module","exports","Scale","window","Core","ScaleCustomProps","scale","PropTypes","array","onScaleChange","func","precision","number","ScaleCustom","_ref","measurementUnits","_slicedToArray","useSelector","state","selectors","getMeasurementUnits","shallowEqual","_useState2","useState","pageValueDisplay","setPageValueDisplay","_useState4","worldValueDisplay","setWorldValueDisplay","_useState6","isFractionalPrecision","setIsFractionalPrecision","_useState8","pageWarningMessage","setPageWarningMessage","_useState0","worldWarningMessage","setWorldWarningMessage","_useState10","scaleValueBlurFlag","setScaleValueBlurFlag","_useState12","leftDropdownWidth","setLeftDropdownWidth","pageValueInput","useRef","worldValueInput","leftContainerRef","t","useTranslation","filterFractionalUnits","units","filter","unit","fractionalUnits","includes","unitFromOptions","from","unitToOptions","to","useEffect","onScaleUnitChange","formatDecimal","value","toFixed","toString","length","current","document","activeElement","getFormattedValue","ifFractionalPrecision","hintValues","isWorldValueValid","onInputValueChange","isPageValueValid","pageScale","newScale","worldScale","_onScaleChange","clientWidth","pageValueClass","classNames","worldValueClass","getPrecision","isPageValue","getNewScale","updateScaleValue","scaleValue","inputValue","trim","scaleUnit","inFractionalRegex","test","result","parseInFractional","ftInFractionalRegex","parseFtInFractional","floatRegex","parseFloat","ftInDecimalRegex","parseFtInDecimal","undefined","newUnit","isPageUnit","newPageScale","newWorldScale","convertUnit","getInputPlaceholder","onInputBlur","flag","React","createElement","className","ref","id","type","min","aria-label","data-element","onChange","e","target","placeholder","onBlur","Icon","glyph","Tooltip","content","Dropdown","labelledById","dataElement","items","onClickItem","currentSelectionKey","width","aria-live","concat","propTypes","ToolNames","Tools","scaleOptions","ScaleModal","_customScale$pageScal","_customScale$worldSca2","annotations","selectedTool","core","useCore","dispatch","useDispatch","_useSelector2","isElementDisabled","DataElements","SCALE_MODAL","isElementOpen","isElementHidden","getSelectedScale","getActiveToolName","getIsAddingNewScale","getMeasurementScalePreset","getCalibrationInfo","getIsMultipleScalesMode","isDisabled","isOpen","isHidden","selectedScale","activeToolName","isAddingNewScale","measurementScalePreset","_useSelector2$","tempScale","isFractionalUnit","isMultipleScalesMode","precisionOptions","PrecisionType","DECIMAL","precisionOption","setPrecisionOption","scaleOption","setScaleOption","PresetMeasurementSystems","METRIC","presetScale","setPresetScale","customScale","setCustomScale","hasScaleChanged","setHasScaleChanged","totalScalesCount","Object","keys","getScales","precisionType","presetMeasurementSystem","getScaleRatioAsArray","getScalePrecision","isFractional","precisionItem","getPrecisionType","find","item","setTimeout","useDidUpdate","presetPrecisionOption","scalePresetPrecision","onToolModeUpdated","newTool","name","CALIBRATION_MEASUREMENT","closeModal","addEventListener","removeEventListener","newPrecisionOption","actions","updateCalibrationInfo","isCalibration","initialScale","closeElement","setIsAddingNewScale","getCurrentScale","getPrecisionsValue","temp","precisionValue","Math","round","isCustomOption","modalClass","open","closed","IMPERIAL","FRACTIONAL","isCurrentScaleValid","isValid","isFractionalUnitsToggleDisabled","ModalWrapper","title","onCloseClick","closeHandler","swipeToClose","Choice","radio","checked","label","center","onClick","_customScale$worldSca","setToolMode","previousToolName","defaultUnit","setIsElementHidden","map","_item","i","ariaLabel","isSwitch","leftLabel","disabled","DataElementWrapper","originalScales","replaceScales","applyTo","_toConsumableArray","createAndApplyScale"],"mappings":"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","file":"chunks/chunk.78.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"LEFT_HEADER_WIDTH\":\"41px\",\"RIGHT_HEADER_WIDTH\":\"41px\"};","import React, { useState, useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { useSelector, shallowEqual } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport selectors from 'selectors';\nimport Tooltip from '../Tooltip';\nimport Dropdown from '../Dropdown';\nimport {\n  ifFractionalPrecision,\n  hintValues,\n  convertUnit,\n  fractionalUnits,\n  floatRegex,\n  inFractionalRegex,\n  ftInFractionalRegex,\n  ftInDecimalRegex,\n  parseFtInDecimal,\n  parseInFractional,\n  parseFtInFractional\n} from 'constants/measurementScale';\nimport classNames from 'classnames';\nimport Icon from 'components/Icon';\n\nconst Scale = window.Core.Scale;\n\nconst ScaleCustomProps = {\n  scale: PropTypes.array,\n  onScaleChange: PropTypes.func,\n  precision: PropTypes.number\n};\n\nfunction ScaleCustom({ scale, onScaleChange, precision }) {\n  const [measurementUnits] = useSelector((state) => [selectors.getMeasurementUnits(state)], shallowEqual);\n  const [pageValueDisplay, setPageValueDisplay] = useState('');\n  const [worldValueDisplay, setWorldValueDisplay] = useState('');\n  const [isFractionalPrecision, setIsFractionalPrecision] = useState(false);\n  const [pageWarningMessage, setPageWarningMessage] = useState('');\n  const [worldWarningMessage, setWorldWarningMessage] = useState('');\n  const [scaleValueBlurFlag, setScaleValueBlurFlag] = useState(false);\n\n  const [leftDropdownWidth, setLeftDropdownWidth] = useState(0);\n  const pageValueInput = useRef(null);\n  const worldValueInput = useRef(null);\n  const leftContainerRef = useRef(null);\n\n  const [t] = useTranslation();\n\n  const filterFractionalUnits = (units) => units.filter((unit) => fractionalUnits.includes(unit));\n  const unitFromOptions = isFractionalPrecision ? filterFractionalUnits(measurementUnits.from) : measurementUnits.from;\n  const unitToOptions = isFractionalPrecision ? filterFractionalUnits(measurementUnits.to) : measurementUnits.to;\n\n  // If our scale has a unit that is not in the current 'from' measurement units, change it\n  // to the first unit in the list.\n  useEffect(() => {\n    if (!unitFromOptions.includes(scale[0][1])) {\n      onScaleUnitChange(unitFromOptions[0], true);\n    }\n  }, [scale[0][1]]);\n\n  // If our scale has a unit that is not in the current 'to' measurement units, change it\n  // to the first unit in the list. We want to wait until the 'from' unit is valid before\n  // setting the 'to' unit. Otherwise, we will reset the 'from' unit.\n  useEffect(() => {\n    if (unitFromOptions.includes(scale[0][1]) && !unitToOptions.includes(scale[1][1])) {\n      onScaleUnitChange(unitToOptions[0], false);\n    }\n  }, [scale[0][1], scale[1][1]]);\n\n  useEffect(() => {\n    const formatDecimal = (value) => {\n      return value?.toFixed((1 / precision).toString().length - 1);\n    };\n\n    if (scale[0][0] && pageValueInput?.current !== document.activeElement) {\n      if (!isFractionalPrecision) {\n        setPageValueDisplay(formatDecimal(scale[0][0]) || '');\n      } else {\n        setPageValueDisplay(Scale.getFormattedValue(scale[0][0], scale[0][1], precision, false, true) || '');\n      }\n    }\n    if (scale[1][0] && !(worldValueInput && worldValueInput.current === document.activeElement)) {\n      if (!isFractionalPrecision && scale[1][1] !== 'ft-in') {\n        setWorldValueDisplay(formatDecimal(scale[1][0]) || '');\n      } else {\n        setWorldValueDisplay(Scale.getFormattedValue(scale[1][0], scale[1][1], precision, false, true) || '');\n      }\n    }\n  }, [scale, precision, worldValueInput, pageValueInput, isFractionalPrecision, scaleValueBlurFlag]);\n\n  useEffect(() => {\n    setIsFractionalPrecision(ifFractionalPrecision(precision));\n  }, [precision]);\n\n  useEffect(() => {\n    if (isFractionalPrecision) {\n      setPageWarningMessage(hintValues[scale[0][1]]);\n      setWorldWarningMessage(hintValues[scale[1][1]]);\n    } else if (scale[1][1] === 'ft-in') {\n      setPageWarningMessage('');\n      setWorldWarningMessage(hintValues['ft-in decimal']);\n    } else {\n      setPageWarningMessage('');\n      setWorldWarningMessage('');\n    }\n  }, [scale, isFractionalPrecision]);\n\n  // Re-validate invalid world value input when world unit changes\n  useEffect(() => {\n    !isWorldValueValid && onInputValueChange(worldValueInput.current.value, false);\n  }, [scale[1][1]]);\n\n  // Re-validate invalid scale value input when isFractionalPrecision value changes\n  useEffect(() => {\n    if (!isPageValueValid && !isWorldValueValid) {\n      let pageScale = {\n        value: scale[0][0],\n        unit: scale[0][1]\n      };\n      onInputValueChange(pageValueInput.current.value, true, (newScale) => {\n        pageScale = newScale.pageScale;\n      });\n      let worldScale = {\n        value: scale[1][0],\n        unit: scale[1][1]\n      };\n      onInputValueChange(worldValueInput.current.value, false, (newScale) => {\n        worldScale = newScale.worldScale;\n      });\n\n      _onScaleChange(new Scale({ pageScale, worldScale }));\n    } else {\n      !isPageValueValid && onInputValueChange(pageValueInput.current.value, true);\n      !isWorldValueValid && onInputValueChange(worldValueInput.current.value, false);\n    }\n  }, [isFractionalPrecision]);\n\n  useEffect(() => {\n    if (leftContainerRef.current) {\n      setLeftDropdownWidth((leftContainerRef.current.clientWidth - 8) / 2);\n    }\n  }, [leftContainerRef]);\n\n  const isPageValueValid = !!scale[0][0];\n  const isWorldValueValid = !!scale[1][0];\n\n  const pageValueClass = classNames('scale-input', {\n    'invalid-value': !isPageValueValid\n  });\n  const worldValueClass = classNames('scale-input', {\n    'invalid-value': !isWorldValueValid\n  });\n\n  // If scale value is smaller than the current precision, replace it with precision value to prevent 0 value.\n  const _onScaleChange = (newScale) => {\n    const getPrecision = (unit) => (unit === 'ft-in' ? precision / 12 : precision);\n\n    if (newScale.pageScale.value && newScale.pageScale.value < precision) {\n      newScale.pageScale.value = getPrecision(newScale.pageScale.unit);\n    }\n    if (newScale.worldScale.value && newScale.worldScale.value < precision) {\n      newScale.worldScale.value = getPrecision(newScale.worldScale.unit);\n    }\n    onScaleChange(newScale);\n  };\n\n  const onInputValueChange = (value, isPageValue, getNewScale) => {\n    const updateScaleValue = (scaleValue) => {\n      if ((isPageValue && scaleValue !== scale[0][0]) || (!isPageValue && scaleValue !== scale[1][0])) {\n        const newScale = new Scale({\n          pageScale: { value: isPageValue ? scaleValue : scale[0][0], unit: scale[0][1] },\n          worldScale: { value: !isPageValue ? scaleValue : scale[1][0], unit: scale[1][1] }\n        });\n        if (getNewScale) {\n          getNewScale(newScale);\n        } else {\n          _onScaleChange(newScale);\n        }\n      }\n    };\n\n    if (isPageValue) {\n      setPageValueDisplay(value);\n    } else {\n      setWorldValueDisplay(value);\n    }\n    const inputValue = value.trim();\n    if (!isFractionalPrecision) {\n      if (!isPageValue && scale[1][1] === 'ft-in') {\n        if (ftInDecimalRegex.test(inputValue)) {\n          const result = parseFtInDecimal(inputValue);\n          if (result > 0) {\n            updateScaleValue(result);\n            return;\n          }\n        }\n      } else if (floatRegex.test(inputValue)) {\n        const scaleValue = parseFloat(inputValue) || 0;\n        updateScaleValue(scaleValue);\n        return;\n      }\n    } else {\n      const scaleUnit = isPageValue ? scale[0][1] : scale[1][1];\n      if (scaleUnit === 'in') {\n        if (inFractionalRegex.test(inputValue)) {\n          const result = parseInFractional(inputValue);\n          if (result > 0) {\n            updateScaleValue(result);\n            return;\n          }\n        }\n      } else if (scaleUnit === 'ft-in') {\n        if (ftInFractionalRegex.test(inputValue)) {\n          const result = parseFtInFractional(inputValue);\n          if (result > 0) {\n            updateScaleValue(result);\n            return;\n          }\n        }\n      }\n    }\n    updateScaleValue(undefined);\n  };\n\n  const onScaleUnitChange = (newUnit, isPageUnit) => {\n    let newPageScale;\n    if (isPageUnit && newUnit !== scale[0][1]) {\n      newPageScale = {\n        value: scale[0][0] ? convertUnit(scale[0][0], scale[0][1], newUnit) : scale[0][0],\n        unit: newUnit\n      };\n    } else {\n      newPageScale = { value: scale[0][0], unit: scale[0][1] };\n    }\n    let newWorldScale;\n    if (!isPageUnit && newUnit !== scale[1][1]) {\n      newWorldScale = {\n        value: scale[1][0] ? convertUnit(scale[1][0], scale[1][1], newUnit) : scale[1][0],\n        unit: newUnit\n      };\n    } else {\n      newWorldScale = { value: scale[1][0], unit: scale[1][1] };\n    }\n\n    _onScaleChange(new Scale({ pageScale: newPageScale, worldScale: newWorldScale }));\n  };\n\n  const getInputPlaceholder = (isPageValue) => {\n    const unit = isPageValue ? scale[0][1] : scale[1][1];\n    return isFractionalPrecision ? hintValues[unit] : (unit === 'ft-in' ? hintValues['ft-in decimal'] : '');\n  };\n\n  const onInputBlur = () => {\n    setScaleValueBlurFlag((flag) => !flag);\n  };\n\n  return (\n    <div className=\"custom-scale-container\">\n      <div className=\"scale-ratio-input-container\">\n        <div className=\"scale-ratio-display\">\n          <div className=\"left-container\" ref={leftContainerRef}>\n            <div className=\"unit-label\" id=\"paper-units-dropdown-label\">{t('option.measurement.scaleModal.paperUnits')}</div>\n            <div className=\"input-wrapper\">\n              <div className={classNames({ 'warning-alert': !isPageValueValid })}>\n                <input\n                  type={isFractionalPrecision ? 'text' : 'number'}\n                  min=\"0\"\n                  className={pageValueClass}\n                  value={pageValueDisplay}\n                  aria-label={t('insertPageModal.pageDimensions.units')}\n                  data-element=\"customPageScaleValue\"\n                  onChange={(e) => onInputValueChange(e.target.value, true)}\n                  placeholder={getInputPlaceholder(true)}\n                  ref={pageValueInput}\n                  onBlur={onInputBlur}\n                />\n                <Icon glyph=\"icon-alert\" className=\"warning-alert-icon\" />\n              </div>\n              <Tooltip content={'option.measurement.scaleModal.paperUnits'}>\n                <div className=\"unit-input\">\n                  <Dropdown\n                    id=\"paper-units-dropdown\"\n                    labelledById='paper-units-dropdown-label'\n                    dataElement=\"customPageScaleUnit\"\n                    items={unitFromOptions}\n                    onClickItem={(value) => onScaleUnitChange(value, true)}\n                    currentSelectionKey={scale[0][1]}\n                    width={leftDropdownWidth}\n                  />\n                </div>\n              </Tooltip>\n            </div>\n          </div>\n          <div className=\"scale-ratio-equal\">{' = '}</div>\n          <div className=\"right-container\">\n            <div className=\"unit-label\" id=\"display-units-dropdown-label\">{t('option.measurement.scaleModal.displayUnits')}</div>\n            <div className=\"input-wrapper\">\n              <div className={classNames({ 'warning-alert': !isWorldValueValid })}>\n                <input\n                  type={(isFractionalPrecision || scale[1][1] === 'ft-in') ? 'text' : 'number'}\n                  min='0'\n                  className={worldValueClass}\n                  value={worldValueDisplay}\n                  aria-label={t('insertPageModal.pageDimensions.units')}\n                  data-element=\"customDisplayScaleValue\"\n                  onChange={(e) => onInputValueChange(e.target.value, false)}\n                  placeholder={getInputPlaceholder(false)}\n                  ref={worldValueInput}\n                  onBlur={onInputBlur}\n                />\n                <Icon glyph=\"icon-alert\" className=\"warning-alert-icon\" />\n              </div>\n              <Tooltip content={'option.measurement.scaleModal.displayUnits'}>\n                <div className=\"unit-input\">\n                  <Dropdown\n                    id=\"display-units-dropdown\"\n                    labelledById='display-units-dropdown-label'\n                    items={unitToOptions}\n                    dataElement=\"customDisplayScaleUnit\"\n                    onClickItem={(value) => onScaleUnitChange(value, false)}\n                    currentSelectionKey={scale[1][1]}\n                    width={leftDropdownWidth}\n                  />\n                </div>\n              </Tooltip>\n            </div>\n          </div>\n\n        </div>\n      </div>\n      <div className=\"warning-messages\" aria-live=\"assertive\" >\n        {!isPageValueValid && (\n          <p className=\"no-margin\">\n            {`${t('option.measurement.scaleModal.incorrectSyntax')} ${pageWarningMessage}`}\n          </p>\n        )}\n        {!isWorldValueValid && (\n          <p className=\"world-value-warning no-margin\">\n            {`${t('option.measurement.scaleModal.incorrectSyntax')} ${worldWarningMessage}`}\n          </p>\n        )}\n      </div>\n    </div>\n  );\n}\n\nScaleCustom.propTypes = ScaleCustomProps;\n\nexport default ScaleCustom;\n","import React, { useEffect, useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport Choice from 'components/Choice';\nimport classNames from 'classnames';\nimport {\n  precisionOptions,\n  PrecisionType,\n  scalePresetPrecision,\n  PresetMeasurementSystems,\n  fractionalUnits,\n  ifFractionalPrecision,\n  initialScale\n} from 'constants/measurementScale';\nimport useCore from 'hooks/useCore';\nimport actions from 'actions';\nimport selectors from 'selectors';\nimport ScaleCustom from './ScaleCustom';\nimport DataElements from 'constants/dataElement';\nimport useDidUpdate from 'hooks/useDidUpdate';\nimport Dropdown from 'components/Dropdown';\nimport Tooltip from 'components/Tooltip';\nimport DataElementWrapper from 'components/DataElementWrapper';\nimport ModalWrapper from 'components/ModalWrapper';\n\nimport './ScaleModal.scss';\nimport '../Choice/Choice.scss';\n\nconst Scale = window.Core.Scale;\nconst { ToolNames } = window.Core.Tools;\n\nexport const scaleOptions = {\n  CUSTOM: 'custom',\n  PRESET: 'preset'\n};\n\nconst ScaleModal = ({ annotations, selectedTool }) => {\n  const { core } = useCore();\n  const dispatch = useDispatch();\n  const [t] = useTranslation();\n\n  const [\n    isDisabled,\n    isOpen,\n    isHidden,\n    selectedScale,\n    activeToolName,\n    isAddingNewScale,\n    measurementScalePreset,\n    { tempScale, isFractionalUnit },\n    isMultipleScalesMode,\n  ] = useSelector((state) => [\n    selectors.isElementDisabled(state, DataElements.SCALE_MODAL),\n    selectors.isElementOpen(state, DataElements.SCALE_MODAL),\n    selectors.isElementHidden(state, DataElements.SCALE_MODAL),\n    selectors.getSelectedScale(state),\n    selectors.getActiveToolName(state),\n    selectors.getIsAddingNewScale(state),\n    selectors.getMeasurementScalePreset(state),\n    selectors.getCalibrationInfo(state),\n    selectors.getIsMultipleScalesMode(state),\n  ]);\n\n  const [isFractionalPrecision, setIsFractionalPrecision] = useState(false);\n  const [precisionOption, setPrecisionOption] = useState(precisionOptions[PrecisionType.DECIMAL][0]);\n  const [scaleOption, setScaleOption] = useState(scaleOptions.CUSTOM);\n  const [presetScale, setPresetScale] = useState(measurementScalePreset[PresetMeasurementSystems.METRIC][0]);\n  const [customScale, setCustomScale] = useState(new Scale(''));\n  const [hasScaleChanged, setHasScaleChanged] = useState(false);\n\n  const totalScalesCount = Object.keys(core.getScales()).length;\n\n  useEffect(() => {\n    if (!precisionOptions[precisionType].includes(precisionOption)) {\n      setPrecisionOption(precisionOptions[precisionType][0]);\n    }\n    setPresetScale(measurementScalePreset[presetMeasurementSystem][0]);\n  }, [isFractionalPrecision]);\n\n  useEffect(() => {\n    setScaleOption(scaleOptions.CUSTOM);\n    setCustomScale(new Scale(selectedScale.getScaleRatioAsArray()));\n\n    const precision = core.getScalePrecision(selectedScale);\n    if (!precision) {\n      return;\n    }\n    const isFractional = ifFractionalPrecision(precision);\n    setIsFractionalPrecision(isFractional);\n\n    const precisionItems = precisionOptions[getPrecisionType(isFractional)];\n    const precisionItem = precisionItems.find((item) => item[1] === precision);\n    setPrecisionOption(precisionItem);\n\n    // Update/Create button should be disabled until the user makes a change\n    setTimeout(() => {\n      setHasScaleChanged(false);\n    });\n  }, [selectedScale]);\n\n  useDidUpdate(() => {\n    if (scaleOption === scaleOptions.CUSTOM) {\n      setCustomScale(presetScale[1]);\n    } else {\n      const presetPrecisionOption = scalePresetPrecision[presetScale[0]];\n      if (presetPrecisionOption && presetPrecisionOption !== precisionOption) {\n        setPrecisionOption(presetPrecisionOption);\n      }\n    }\n  }, [scaleOption]);\n\n  useEffect(() => {\n    // Close modal when switching tools outside of calibration flow\n    const onToolModeUpdated = (newTool) => {\n      const isNewToolCalibration = newTool.name === ToolNames.CALIBRATION_MEASUREMENT;\n      if (!isNewToolCalibration && isOpen && !isHidden) {\n        closeModal();\n      }\n    };\n    core.addEventListener('toolModeUpdated', onToolModeUpdated);\n    return () => core.removeEventListener('toolModeUpdated', onToolModeUpdated);\n  }, [isOpen, isHidden]);\n\n  useEffect(() => {\n    const newPrecisionOption = scalePresetPrecision[presetScale[0]];\n    if (newPrecisionOption && scaleOption === scaleOptions.PRESET) {\n      setPrecisionOption(newPrecisionOption);\n    }\n  }, [presetScale]);\n\n  useEffect(() => {\n    if (!isHidden && tempScale) {\n      // Triggered when calibration is applied\n      setCustomScale(new Scale(tempScale));\n      dispatch(actions.updateCalibrationInfo({ isCalibration: false }));\n      setIsFractionalPrecision(isFractionalUnit);\n    }\n  }, [isHidden]);\n\n  useEffect(() => {\n    setHasScaleChanged(true);\n  }, [precisionOption, customScale, presetScale, scaleOption]);\n\n  useEffect(() => {\n    // Reset component state when adding new scale\n    if (isOpen && isAddingNewScale && !tempScale) {\n      setScaleOption(scaleOptions.CUSTOM);\n      setCustomScale(initialScale);\n      setIsFractionalPrecision(false);\n      setPrecisionOption(precisionOptions[PrecisionType.DECIMAL][0]);\n    }\n  }, [isOpen, isAddingNewScale]);\n\n  const closeModal = () => {\n    dispatch(actions.closeElement(DataElements.SCALE_MODAL));\n    dispatch(actions.setIsAddingNewScale(false));\n  };\n\n  const createAndApplyScale = (scale, applyTo) => {\n    core.createAndApplyScale(scale, applyTo);\n    closeModal();\n  };\n\n  const replaceScales = (originalScales, scale) => {\n    core.replaceScales(originalScales, scale);\n    closeModal();\n  };\n\n  const toggleFractionalPrecision = () => {\n    setIsFractionalPrecision((isFractionalPrecision) => !isFractionalPrecision);\n  };\n\n  const openCalibrationTool = () => {\n    core.setToolMode('AnnotationCreateCalibrationMeasurement');\n    const unit = isCustomOption ? (customScale.worldScale?.unit || '') : presetScale[1].worldScale.unit;\n    dispatch(actions.updateCalibrationInfo({ isCalibration: true, previousToolName: activeToolName, defaultUnit: unit }));\n    dispatch(actions.setIsElementHidden(DataElements.SCALE_MODAL, true));\n  };\n\n  const getCurrentScale = () => {\n    const getPrecisionsValue = (value, unit) => {\n      let temp = value;\n      let precisionValue = precisionOption[1];\n\n      if (!isFractionalPrecision) {\n        if (unit !== 'ft-in') {\n          temp = temp.toFixed((1 / precisionValue).toString().length - 1);\n        }\n      } else {\n        if (unit === 'ft-in') {\n          precisionValue /= 12;\n        }\n        temp = Math.round(temp / precisionValue) * precisionValue;\n      }\n\n      return temp * 1;\n    };\n\n    if (isCustomOption) {\n      const scale = customScale.getScaleRatioAsArray();\n      scale[0][0] = getPrecisionsValue(scale[0][0], scale[0][1]);\n      scale[1][0] = getPrecisionsValue(scale[1][0], scale[1][1]);\n      return scale;\n    }\n    return presetScale[1].toString();\n  };\n\n  const onUpdate = () => {\n    replaceScales(\n      [selectedScale],\n      new Scale(getCurrentScale(), precisionOption[1])\n    );\n  };\n\n  const onCreate = () => {\n    createAndApplyScale(\n      new Scale(getCurrentScale(), precisionOption[1]),\n      [...annotations, selectedTool]\n    );\n  };\n\n  const modalClass = classNames('Modal', 'ScaleModal', {\n    open: !isHidden,\n    closed: isHidden\n  });\n  const isCustomOption = scaleOption === scaleOptions.CUSTOM;\n  const presetMeasurementSystem = isFractionalPrecision ? PresetMeasurementSystems.IMPERIAL : PresetMeasurementSystems.METRIC;\n  const getPrecisionType = (isFractional) => (isFractional ? PrecisionType.FRACTIONAL : PrecisionType.DECIMAL);\n  const precisionType = getPrecisionType(isFractionalPrecision);\n  const isCurrentScaleValid = !isCustomOption || customScale.isValid();\n  const isFractionalUnitsToggleDisabled = isCustomOption && !(fractionalUnits.includes(customScale.pageScale?.unit) && fractionalUnits.includes(customScale.worldScale?.unit));\n\n  return !isDisabled && (\n    <div className={modalClass} data-element={DataElements.SCALE_MODAL}>\n      <ModalWrapper\n        title=\"option.measurementOption.scale\"\n        isOpen={isOpen}\n        onCloseClick={closeModal}\n        closeHandler={closeModal}\n        swipeToClose\n      >\n        <div className=\"content-container\">\n          <div className=\"scaleSetting\">\n            <div className=\"custom-option-wrapper\">\n              <div className=\"custom-scale-option\">\n                <Choice\n                  data-element=\"customScaleOption\"\n                  radio\n                  name=\"setting\"\n                  onChange={() => setScaleOption(scaleOptions.CUSTOM)}\n                  checked={isCustomOption}\n                  label={`${t('option.measurement.scaleModal.custom')}:`}\n                  center\n                />\n              </div>\n              {isCustomOption && (\n                <button data-element=\"calibrate\" className=\"calibrate-btn\" onClick={openCalibrationTool}>\n                  {t('option.measurement.scaleModal.calibrate')}\n                </button>\n              )}\n            </div>\n            {isCustomOption ? (\n              <ScaleCustom\n                scale={customScale.getScaleRatioAsArray()}\n                onScaleChange={setCustomScale}\n                precision={precisionOption[1]}\n              />\n            ) : (\n              null\n            )}\n            <div className=\"custom-scale-option\">\n              <Choice\n                data-element=\"presetScaleOption\"\n                radio\n                onChange={() => setScaleOption(scaleOptions.PRESET)}\n                name=\"setting\"\n                checked={!isCustomOption}\n                label={`${t('option.measurement.scaleModal.preset')}:`}\n                center\n              />\n            </div>\n            {!isCustomOption && (\n              <div className=\"scaleModal__preset-container\">\n                <div className=\"selector\">\n                  <Dropdown\n                    id=\"preset-scale-dropdown\"\n                    dataElement=\"presetScales\"\n                    items={measurementScalePreset[presetMeasurementSystem].map((item) => item[0])}\n                    currentSelectionKey={presetScale[0]}\n                    onClickItem={(_item, i) => setPresetScale(measurementScalePreset[presetMeasurementSystem][i])}\n                  />\n                </div>\n              </div>\n            )}\n\n            {isCustomOption ? null : (\n              <div className=\"block\" />\n            )}\n          </div>\n          <div className=\"precision-container\">\n            <div className=\"precision-selector\">\n              <div className=\"precision-title\" id=\"scale-precision-dropdown-label\">{t('option.shared.precision')}:</div>\n              <div className=\"selector\">\n                <Dropdown\n                  id=\"scale-precision-dropdown\"\n                  labelledById='scale-precision-dropdown-label'\n                  dataElement=\"scalePrecisions\"\n                  items={precisionOptions[precisionType].map((item) => item[0])}\n                  currentSelectionKey={precisionOption[0]}\n                  onClickItem={(_item, i) => setPrecisionOption(precisionOptions[precisionType][i])}\n                  ariaLabel={t('option.shared.precision')}\n                />\n              </div>\n            </div>\n            <Tooltip content={t('option.measurement.scaleModal.fractionUnitsTooltip')}>\n              <div className=\"fractional-units-container\">\n                <Choice\n                  isSwitch\n                  leftLabel\n                  id=\"scale-modal-fractional-units\"\n                  label={t('option.measurement.scaleModal.fractionalUnits')}\n                  checked={isFractionalPrecision}\n                  onChange={toggleFractionalPrecision}\n                  disabled={isFractionalUnitsToggleDisabled}\n                />\n              </div>\n            </Tooltip>\n          </div>\n        </div>\n        <div className=\"footer\">\n          <DataElementWrapper\n            type={'button'}\n            onClick={onUpdate}\n            className=\"scale-update\"\n            dataElement=\"updateScale\"\n            disabled={isAddingNewScale || !isCurrentScaleValid || !hasScaleChanged}\n          >\n            {t('action.update')}\n          </DataElementWrapper>\n          <button\n            onClick={onCreate}\n            className=\"scale-create\"\n            data-element=\"createScale\"\n            disabled={!isCurrentScaleValid || (!isMultipleScalesMode && totalScalesCount) || (!isAddingNewScale && !hasScaleChanged)}\n          >\n            {t('action.create')}\n          </button>\n        </div>\n      </ModalWrapper>\n    </div>\n  );\n};\n\nexport default ScaleModal;\n","import ScaleModal from './ScaleModal';\n\nexport default ScaleModal;"],"sourceRoot":""}