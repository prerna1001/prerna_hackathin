{"version":3,"sources":["webpack:///./src/ui/src/components/MeasurementOverlay/MeasurementOverlay.scss?2036","webpack:///./src/ui/src/components/MeasurementOverlay/CustomMeasurementOverlay.js","webpack:///./src/ui/src/components/MeasurementOverlay/CountMeasurementOverlay.js","webpack:///./src/ui/src/components/MeasurementOverlay/MeasurementOverlay.js","webpack:///./src/ui/src/components/MeasurementOverlay/index.js"],"names":["module","exports","CustomMeasurementOverlay","props","type","mapAnnotationToKey","annotation","React","createElement","CustomEllipseMeasurementOverlay","console","error","concat","renderAppropriateOverlay","factor","annotationKey","icon","getDataWithKey","t","distanceMeasurementTool","useCore","core","getTool","precision","defaults","Precision","scale","Scale","measure","Measure","unit","Fragment","className","Icon","glyph","title","label","min","value","axis","toFixed","onChange","event","propTypes","PropTypes","object","isRequired","func","string","withTranslation","CountMeasurementOverlay","useTranslation","annotationCount","getAnnotationsList","filter","getCustomData","length","MeasurementOverlay","setValue","isDisabled","useSelector","state","selectors","isElementDisabled","DataElements","MEASUREMENT_OVERLAY","forceUpdate","_slicedToArray","useState","dispatch","useDispatch","_useState4","x","y","position","setPosition","_useState6","transparentBackground","setTransparentBackground","_useState8","isCreatingAnnotation","setIsCreatingAnnotation","isOpen","isElementOpen","activeToolName","getActiveToolName","customMeasurementOverlay","getCustomMeasurementOverlay","overlayRef","useRef","key","shouldShowCustomOverlay","annot","includes","isCountMeasurementAnnotation","some","overlay","validate","onMouseMove","e","tool","useTransparentBackground","insideRect","overlayElement","overlayRect","getBoundingClientRect","touches","TouchEvent","clientX","clientY","left","right","top","bottom","isMouseInsideRect","current","_core$getToolMode$get","_core$getToolMode","drawMode","getToolMode","getDrawMode","call","annotUnderMouse","getAnnotationByMouseEvent","actions","openElement","onAnnotationChanged","annotations","action","closeElement","useEffect","addEventListener","removeEventListener","Draggable","cancel","onDrag","_ref","onStop","_ref2","classNames","Overlay","open","closed","transparent","ref","data-element","_extends","customOverlay","renderOverlay"],"mappings":"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","file":"chunks/chunk.70.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"LEFT_HEADER_WIDTH\":\"41px\",\"RIGHT_HEADER_WIDTH\":\"41px\"};","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { withTranslation } from 'react-i18next';\nimport Icon from 'components/Icon';\nimport useCore from 'hooks/useCore';\nimport { mapAnnotationToKey, getDataWithKey } from '../../constants/map';\n\nfunction CustomMeasurementOverlay(props) {\n  const renderAppropriateOverlay = (type) => {\n    const annotationType = mapAnnotationToKey(props.annotation);\n    switch (annotationType) {\n      case 'ellipse':\n        return <CustomEllipseMeasurementOverlay {...props}/>;\n      default:\n        console.error(`Custom overlay for annotation type: ${type} not supported`);\n    }\n  };\n  return (renderAppropriateOverlay(props.type));\n}\n\nCustomMeasurementOverlay.propTypes = {\n  annotation: PropTypes.object.isRequired,\n  value: PropTypes.func.isRequired,\n  onChange: PropTypes.func.isRequired,\n  label: PropTypes.string.isRequired,\n  t: PropTypes.func.isRequired,\n  title: PropTypes.string.isRequired,\n};\n\nfunction CustomEllipseMeasurementOverlay(props) {\n  const annotationKey = mapAnnotationToKey(props.annotation);\n  const { icon } = getDataWithKey(annotationKey);\n  const { t } = props;\n  const { core } = useCore();\n\n  // Get the Scale, Precision and Units from\n  // the AnnotationCreateDistanceMeasurement tool as these do not exist\n  // in the Ellipse annotation\n  const distanceMeasurementTool = core.getTool('AnnotationCreateDistanceMeasurement');\n  const precision = distanceMeasurementTool.defaults.Precision;\n  const scale = distanceMeasurementTool.defaults.Scale;\n  const measure = distanceMeasurementTool.Measure;\n  const unit = scale[1][1];\n\n\n  const renderScaleRatio = () => `${scale[0][0]} ${scale[0][1]} = ${scale[1][0]} ${scale[1][1]}`;\n\n  const computeRadius = () => {\n    const decimalPlaces = 2;\n    const factor = measure.axis[0].factor;\n    const radiusInPts = props.value(props.annotation).toFixed(decimalPlaces);\n    return (radiusInPts * factor).toFixed(decimalPlaces);\n  };\n\n  return (\n    <>\n      <div className=\"measurement__title\">\n        {icon && <Icon className=\"measurement__icon\" glyph={icon} />}\n        {props.title}\n      </div>\n      <div className=\"measurement__scale\">\n        {t('option.measurementOverlay.scale')}: {renderScaleRatio()}\n      </div>\n      <div className=\"measurement__precision\">\n        {t('option.shared.precision')}: {precision}\n      </div>\n      <div className=\"measurement__value\">\n        {props.label}: <input className=\"lineMeasurementInput\" type=\"number\" min=\"0\" value={computeRadius()} onChange={(event) => props.onChange(event, props.annotation)}/> {unit}\n      </div>\n    </>\n  );\n}\n\nCustomEllipseMeasurementOverlay.propTypes = CustomMeasurementOverlay.propTypes;\n\nexport default withTranslation()(CustomMeasurementOverlay);","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport Icon from 'components/Icon';\nimport useCore from 'hooks/useCore';\nimport { mapAnnotationToKey, getDataWithKey } from '../../constants/map';\n\nCountMeasurementOverlay.propTypes = {\n  annotation: PropTypes.object.isRequired\n};\n\nfunction CountMeasurementOverlay(props) {\n  const annotationKey = mapAnnotationToKey(props.annotation);\n  const { icon } = getDataWithKey(annotationKey);\n  const { core } = useCore();\n  const { t } = useTranslation();\n  const annotationList = core.getAnnotationsList();\n\n  const measurementAnnotationsList = annotationList.filter((annotation) => {\n    return annotation.getCustomData('trn-is-count');\n  });\n  const annotationCount = measurementAnnotationsList.length;\n\n  return (\n    <>\n      <div className=\"measurement__title\">\n        {icon && <Icon className=\"measurement__icon\" glyph={icon} />}\n        {t('option.measurementOverlay.countMeasurement')}\n      </div>\n      <div className=\"measurement__count\">\n        {t('option.measurementOverlay.count')}: {annotationCount}\n      </div>\n    </>\n  );\n}\n\nexport default CountMeasurementOverlay;","import React, { useState, useRef, useEffect } from 'react';\nimport classNames from 'classnames';\nimport Draggable from 'react-draggable';\nimport PropTypes from 'prop-types';\nimport useCore from 'hooks/useCore';\nimport { mapAnnotationToKey } from 'constants/map';\nimport actions from 'actions';\nimport selectors from 'selectors';\nimport { useSelector, useDispatch } from 'react-redux';\nimport CustomMeasurementOverlay from './CustomMeasurementOverlay';\nimport CountMeasurementOverlay from './CountMeasurementOverlay';\nimport DataElements from 'constants/dataElement';\n\nimport './MeasurementOverlay.scss';\n\nconst isMouseInsideRect = (e, overlayElement) => {\n  if (overlayElement === null) {\n    return false;\n  }\n\n  const overlayRect = overlayElement.getBoundingClientRect();\n  let x; let y;\n  if (e.touches && e instanceof TouchEvent) {\n    x = e.touches[0].clientX;\n    y = e.touches[0].clientY;\n  } else {\n    x = e.clientX;\n    y = e.clientY;\n  }\n  return (\n    x >= overlayRect.left &&\n    x <= overlayRect.right &&\n    y >= overlayRect.top &&\n    y <= overlayRect.bottom\n  );\n};\n\nconst isCountMeasurementAnnotation = (annot) => ['countMeasurement'].includes(mapAnnotationToKey(annot));\n\n// create your forceUpdate hook\nfunction useForceUpdate() {\n  const [, setValue] = useState(0); // integer state\n  return () => setValue((value) => value + 1); // update state to force render\n}\n\nconst propTypes = {\n  annotation: PropTypes.object,\n};\n\nconst MeasurementOverlay = (props) => {\n  const { core } = useCore();\n  const { annotation } = props;\n  const isDisabled = useSelector((state) => selectors.isElementDisabled(state, DataElements.MEASUREMENT_OVERLAY));\n\n  const forceUpdate = useForceUpdate();\n  const dispatch = useDispatch();\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const [transparentBackground, setTransparentBackground] = useState(false);\n  const [isCreatingAnnotation, setIsCreatingAnnotation] = useState(false);\n  const isOpen = useSelector((state) => selectors.isElementOpen(state, DataElements.MEASUREMENT_OVERLAY));\n  const activeToolName = useSelector((state) => selectors.getActiveToolName(state));\n  const customMeasurementOverlay = useSelector((state) => selectors.getCustomMeasurementOverlay(state));\n  const overlayRef = useRef();\n  const key = mapAnnotationToKey(annotation);\n\n  const shouldShowCustomOverlay = (annot) => (!isCountMeasurementAnnotation(annot) && customMeasurementOverlay.some((overlay) => overlay.validate(annot)));\n\n  const renderOverlay = (annot, key) => {\n    if (shouldShowCustomOverlay(annot)) {\n      return (\n        <CustomMeasurementOverlay\n          annotation={annot}\n          {...customMeasurementOverlay.filter((customOverlay) => customOverlay.validate(annot)\n          )[0]}\n        />\n      );\n    }\n    if (key === 'countMeasurement') {\n      return <CountMeasurementOverlay annotation={annot} />;\n    }\n  };\n\n  const onMouseMove = (e) => {\n    const tool = core.getTool(activeToolName);\n\n    if (annotation) {\n      const insideRect = isMouseInsideRect(e, overlayRef.current);\n      let useTransparentBackground;\n\n      if (isCreatingAnnotation) {\n        const drawMode = core.getToolMode().getDrawMode?.();\n        useTransparentBackground = insideRect && drawMode !== 'twoClicks';\n      } else {\n        const annotUnderMouse = core.getAnnotationByMouseEvent(e);\n        useTransparentBackground = insideRect && annotUnderMouse === annotation;\n      }\n      setTransparentBackground(useTransparentBackground);\n      forceUpdate();\n    } else if (shouldShowCustomOverlay(tool.annotation)) {\n      dispatch(actions.openElement(DataElements.MEASUREMENT_OVERLAY));\n      // this.setState({ annotation: tool.annotation });\n      // we know we are creating an annotation at this point because tool.annotation is truthy\n      setIsCreatingAnnotation(true);\n    }\n  };\n\n  const onAnnotationChanged = (annotations, action) => {\n    // measurement overlay will open and show the annotation information when we are creating an annotation using measurement tools\n    // since by default we don't auto select an annotation after it's created, we close the overlay here to avoid the confusion\n    // where no annotation is selected but measurement overlay shows the information about the annotation we were creating\n    if (\n      action === 'add' &&\n      annotations.length === 1 &&\n      annotations[0] === annotation\n    ) {\n      dispatch(actions.closeElement(DataElements.MEASUREMENT_OVERLAY));\n    }\n\n    if (\n      action === 'modify' &&\n      annotations.length === 1 &&\n      annotations[0] === annotation\n    ) {\n      forceUpdate();\n    }\n  };\n\n  useEffect(() => {\n    core.addEventListener('mouseMove', onMouseMove);\n    core.addEventListener('annotationChanged', onAnnotationChanged);\n    return () => {\n      core.removeEventListener('mouseMove', onMouseMove);\n      core.removeEventListener('annotationChanged', onAnnotationChanged);\n    };\n  }, []);\n\n  if (isDisabled || !annotation) {\n    return null;\n  }\n\n  return (\n    <Draggable\n      cancel=\"input\"\n      position={position}\n      onDrag={(e, { x, y }) => setPosition({ x, y })}\n      onStop={(e, { x, y }) => setPosition({ x, y })}\n    >\n      <div\n        className={classNames({\n          Overlay: true,\n          MeasurementOverlay: true,\n          open: isOpen,\n          closed: !isOpen,\n          transparent: transparentBackground,\n        })}\n        ref={overlayRef}\n        data-element={DataElements.MEASUREMENT_OVERLAY}\n      >\n        {renderOverlay(annotation, key)}\n      </div>\n    </Draggable>\n  );\n};\n\nMeasurementOverlay.propTypes = propTypes;\n\nexport default MeasurementOverlay;\n","import MeasurementOverlay from './MeasurementOverlay';\n\nexport default MeasurementOverlay;"],"sourceRoot":""}