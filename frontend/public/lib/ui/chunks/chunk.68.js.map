{"version":3,"sources":["webpack:///./src/ui/src/components/LinkAnnotationPopup/LinkAnnotationPopup.scss?c69a","webpack:///./src/ui/src/components/LinkAnnotationPopup/LinkAnnotationPopup.js","webpack:///./src/ui/src/components/LinkAnnotationPopup/LinkAnnotationPopupContainer.js","webpack:///./src/ui/src/components/LinkAnnotationPopup/index.js"],"names":["module","exports","propTypes","handleUnLink","PropTypes","func","isAnnotation","bool","isMobileDevice","linkText","string","handleOnMouseEnter","handleOnMouseLeave","handleMouseMove","LinkAnnotationPopup","_ref","React","createElement","data-testid","className","classNames","Popup","onMouseEnter","onMouseLeave","onMouseMove","data-element","DataElements","LINK_URI","Fragment","ActionButton","dataElement","LINK_ANNOTATION_UNLINK_BUTTON","title","img","onClick","Annotations","window","Core","annotation","object","LinkAnnotationPopupContainer","core","useCore","_useSelector2","_slicedToArray","useSelector","state","selectors","isElementOpen","LINK_ANNOTATION_POPUP","getActiveDocumentViewerKey","shallowEqual","isOpen","activeDocumentViewerKey","_useState2","useState","left","top","position","setPosition","dispatch","useDispatch","popupRef","useRef","store","useStore","closePopup","actions","closeElement","useOnClickOutside","useEffect","onScroll","scrollViewElement","getScrollViewElement","addEventListener","removeEventListener","useLayoutEffect","setPopupPosition","current","getAnnotationPopupPositionBasedOn","contents","getLinkDestination","open","closed","undefined","DataElementWrapper","style","_objectSpread","ref","arguments","length","annotationManager","getAnnotationManager","textHighlightAnnotation","getGroupAnnotations","find","annot","index","TextHighlightAnnotation","Opacity","linkAnnotations","getGroupedLinkAnnotations","forEach","linkAnnot","ungroupAnnotations","deleteAnnotation","deleteLinkAnnotationWithGroup","isMobileSize","event","preventDefault","stopPropagation"],"mappings":"qGACAA,EAAOC,QAAU,CAAC,kBAAoB,OAAO,mBAAqB,S,+SCO5DC,G,QAAY,CAChBC,aAAcC,IAAUC,KACxBC,aAAcF,IAAUG,KACxBC,eAAgBJ,IAAUG,KAC1BE,SAAUL,IAAUM,OACpBC,mBAAoBP,IAAUC,KAC9BO,mBAAoBR,IAAUC,KAC9BQ,gBAAiBT,IAAUC,OAGvBS,EAAsB,SAAHC,GAQnB,IAPJZ,EAAYY,EAAZZ,aACAG,EAAYS,EAAZT,aACAE,EAAcO,EAAdP,eACAC,EAAQM,EAARN,SACAE,EAAkBI,EAAlBJ,mBACAC,EAAkBG,EAAlBH,mBACAC,EAAeE,EAAfF,gBAsBA,OAAIL,IAAmBF,EACd,KAIPU,IAAAC,cAAA,OACEC,cAAY,0BACZC,UAAWC,IAAW,CACpBC,OAAO,EACPP,qBAAqB,EACrB,iBAAiB,IAEnBQ,aAAcX,EACdY,aAAcX,EACdY,YAAaX,GAjCfG,IAAAC,cAAA,OAAKE,UAAU,WAAWM,eAAcC,IAAaC,UAClDlB,GACCO,IAAAC,cAAAD,IAAAY,SAAA,KACEZ,IAAAC,cAAA,OAAKE,UAAU,oBACZV,GAEHO,IAAAC,cAAA,OAAKE,UAAU,aAGnBH,IAAAC,cAACY,IAAY,CACXV,UAAU,mBACVW,YAAaJ,IAAaK,8BAC1BC,MAAM,gBACNC,IAAI,mBACJC,QAAS/B,OA0BjBW,EAAoBZ,UAAYA,EAEjBY,Q,8vEC5Cf,IAAQqB,EAAgBC,OAAOC,KAAvBF,YAEFjC,EAAY,CAChBoC,WAAYlC,IAAUmC,OACtB5B,mBAAoBP,IAAUC,KAC9BO,mBAAoBR,IAAUC,MAmB1BmC,EAA+B,SAAHzB,GAI5B,IAHJuB,EAAUvB,EAAVuB,WACA3B,EAAkBI,EAAlBJ,mBACAC,EAAkBG,EAAlBH,mBAEQ6B,EAASC,cAATD,KAOQE,EAAAC,EAHZC,aAAY,SAACC,GAAK,MAAK,CACzBC,IAAUC,cAAcF,EAAOpB,IAAauB,uBAC5CF,IAAUG,2BAA2BJ,MACpCK,KAAa,GALdC,EAAMT,EAAA,GACNU,EAAuBV,EAAA,GAMoCW,EAAAV,EAA7BW,mBAAS,CAAEC,KAAM,EAAGC,IAAK,IAAI,GAAtDC,EAAQJ,EAAA,GAAEK,EAAWL,EAAA,GACtBM,EAAWC,cACXC,EAAWC,iBAAO,MAClBC,EAAQC,cAERC,EAAa,WAAH,OAASN,EAASO,IAAQC,aAAa1C,IAAauB,yBAOpEoB,YAAkBP,GAAU,WACtBV,GACFc,OAIJI,qBAAU,WACR,IAAMC,EAAW,WACfL,KAGIM,EAAoB/B,EAAKgC,uBAE/B,OADAD,WAAmBE,iBAAiB,SAAUH,GACvC,WACLC,WAAmBG,oBAAoB,SAAUJ,MAElD,IAEHK,2BAAgB,YACVtC,GAAcc,IAChByB,MAED,CAACvC,EAAYc,EAAQC,IAExB,IAAMwB,EAAmB,WACnBvC,GAAcwB,EAASgB,SACzBnB,EAAYoB,YAAkCzC,EAAYwB,EAAUT,EAAyB,KAI3F2B,EAAWC,YAAmB3C,EAAY0B,IAAU,GAQpD7C,EAAYC,IAAW,CAC3BC,OAAO,EACPmB,8BAA8B,EAC9B0C,KAAM9B,EACN+B,QAAS/B,IAGL9C,OAA8B8E,IAAf9C,EAErB,OACEtB,IAAAC,cAACoE,IAAkB,CACjBvD,YAAaJ,IAAauB,sBAC1B9B,UAAWA,EACXmE,MAAKC,EAAA,GAAO7B,GACZ8B,IAAK1B,GAEL9C,IAAAC,cAACH,EAAmB,CAClBL,SAAUuE,EACV7E,aAxBe,YA1EsB,SAACmC,GAAkD,IAAtCe,EAAuBoC,UAAAC,OAAA,QAAAN,IAAAK,UAAA,GAAAA,UAAA,GAAG,EAAGhD,EAAIgD,UAAAC,OAAA,EAAAD,UAAA,QAAAL,EACnFO,EAAoBlD,EAAKmD,qBAAqBvC,GAC9CwC,EAA0BF,EAAkBG,oBAAoBxD,GAAYyD,MAAK,SAACC,EAAOC,GAAK,OAAKD,aAAiB7D,EAAY+D,yBAA6C,IAAlBF,EAAMG,SAA2B,IAAVF,KAClLG,EAAkBC,YAA0B/D,GAClD8D,EAAgBE,SAAQ,SAACC,GACvBZ,EAAkBa,mBAAmB,CAACD,IAClCV,GACFF,EAAkBc,iBAAiBF,EAAW,CAAE,OAAU,WAAY,MAGtEV,GACFF,EAAkBc,iBAAiBZ,EAAyB,CAAE,OAAU,WAAY,GAEtFF,EAAkBc,iBAAiBnE,EAAY,CAAE,OAAU,WAAY,GA8DrEoE,CAA8BpE,EAAYe,EAAyBZ,GACnEyB,IACAtD,KAsBIN,aAAcA,EACdE,eAAgBmG,cAChBhG,mBAAoBA,EACpBC,mBAAoBA,EACpBC,gBAlEkB,SAAC+F,GACvBA,EAAMC,iBACND,EAAME,uBAuEVtE,EAA6BtC,UAAYA,EAE1BsC,QChJAA","file":"chunks/chunk.68.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"LEFT_HEADER_WIDTH\":\"41px\",\"RIGHT_HEADER_WIDTH\":\"41px\"};","import ActionButton from 'components/ActionButton';\nimport classNames from 'classnames';\nimport DataElements from 'constants/dataElement';\nimport PropTypes from 'prop-types';\nimport React from 'react';\n\nimport './LinkAnnotationPopup.scss';\n\nconst propTypes = {\n  handleUnLink: PropTypes.func,\n  isAnnotation: PropTypes.bool,\n  isMobileDevice: PropTypes.bool,\n  linkText: PropTypes.string,\n  handleOnMouseEnter: PropTypes.func,\n  handleOnMouseLeave: PropTypes.func,\n  handleMouseMove: PropTypes.func,\n};\n\nconst LinkAnnotationPopup = ({\n  handleUnLink,\n  isAnnotation,\n  isMobileDevice,\n  linkText,\n  handleOnMouseEnter,\n  handleOnMouseLeave,\n  handleMouseMove\n}) => {\n  const renderContents = () => (\n    <div className=\"contents\" data-element={DataElements.LINK_URI}>\n      {linkText && (\n        <>\n          <div className=\"link-annot-input\">\n            {linkText}\n          </div>\n          <div className=\"divider\" />\n        </>\n      )}\n      <ActionButton\n        className=\"main-menu-button\"\n        dataElement={DataElements.LINK_ANNOTATION_UNLINK_BUTTON}\n        title='action.unlink'\n        img='icon-tool-unlink'\n        onClick={handleUnLink}\n      />\n    </div>\n  );\n\n  if (isMobileDevice || !isAnnotation) {\n    return null;\n  }\n\n  return (\n    <div\n      data-testid=\"link-annotation-element\"\n      className={classNames({\n        Popup: true,\n        LinkAnnotationPopup: true,\n        'is-horizontal': true\n      })}\n      onMouseEnter={handleOnMouseEnter}\n      onMouseLeave={handleOnMouseLeave}\n      onMouseMove={handleMouseMove}\n    >\n      {renderContents()}\n    </div>\n  );\n};\n\nLinkAnnotationPopup.propTypes = propTypes;\n\nexport default LinkAnnotationPopup;\n","import actions from 'actions';\nimport classNames from 'classnames';\nimport useCore from 'hooks/useCore';\nimport DataElements from 'constants/dataElement';\nimport DataElementWrapper from '../DataElementWrapper';\nimport { getAnnotationPopupPositionBasedOn } from 'helpers/getPopupPosition';\nimport { isMobileSize } from 'helpers/getDeviceSize';\nimport LinkAnnotationPopup from './LinkAnnotationPopup';\nimport PropTypes from 'prop-types';\nimport selectors from 'selectors';\nimport getLinkDestination from 'helpers/getLinkDestination';\nimport useOnClickOutside from 'hooks/useOnClickOutside';\nimport React, {\n  useState,\n  useRef,\n  useLayoutEffect,\n  useEffect\n} from 'react';\nimport {\n  useSelector,\n  shallowEqual,\n  useDispatch,\n  useStore\n} from 'react-redux';\nimport getGroupedLinkAnnotations from 'src/helpers/getGroupedLinkAnnotations';\n\nconst { Annotations } = window.Core;\n\nconst propTypes = {\n  annotation: PropTypes.object,\n  handleOnMouseEnter: PropTypes.func,\n  handleOnMouseLeave: PropTypes.func,\n};\n\nexport const deleteLinkAnnotationWithGroup = (annotation, activeDocumentViewerKey = 1, core) => {\n  const annotationManager = core.getAnnotationManager(activeDocumentViewerKey);\n  const textHighlightAnnotation = annotationManager.getGroupAnnotations(annotation).find((annot, index) => annot instanceof Annotations.TextHighlightAnnotation && annot.Opacity === 0 && index === 0);\n  const linkAnnotations = getGroupedLinkAnnotations(annotation);\n  linkAnnotations.forEach((linkAnnot) => {\n    annotationManager.ungroupAnnotations([linkAnnot]);\n    if (textHighlightAnnotation) {\n      annotationManager.deleteAnnotation(linkAnnot, { 'source': 'unlink' }, true);\n    }\n  });\n  if (textHighlightAnnotation) {\n    annotationManager.deleteAnnotation(textHighlightAnnotation, { 'source': 'unlink' }, true);\n  }\n  annotationManager.deleteAnnotation(annotation, { 'source': 'unlink' }, true);\n};\n\nconst LinkAnnotationPopupContainer = ({\n  annotation,\n  handleOnMouseEnter,\n  handleOnMouseLeave\n}) => {\n  const { core } = useCore();\n  const [\n    isOpen,\n    activeDocumentViewerKey,\n  ] = useSelector((state) => [\n    selectors.isElementOpen(state, DataElements.LINK_ANNOTATION_POPUP),\n    selectors.getActiveDocumentViewerKey(state),\n  ], shallowEqual);\n\n  const [position, setPosition] = useState({ left: 0, top: 0 });\n  const dispatch = useDispatch();\n  const popupRef = useRef(null);\n  const store = useStore();\n\n  const closePopup = () => dispatch(actions.closeElement(DataElements.LINK_ANNOTATION_POPUP));\n\n  const handleMouseMove = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n  };\n\n  useOnClickOutside(popupRef, () => {\n    if (isOpen) {\n      closePopup();\n    }\n  });\n\n  useEffect(() => {\n    const onScroll = () => {\n      closePopup();\n    };\n\n    const scrollViewElement = core.getScrollViewElement();\n    scrollViewElement?.addEventListener('scroll', onScroll);\n    return () => {\n      scrollViewElement?.removeEventListener('scroll', onScroll);\n    };\n  }, []);\n\n  useLayoutEffect(() => {\n    if (annotation || isOpen) {\n      setPopupPosition();\n    }\n  }, [annotation, isOpen, activeDocumentViewerKey]);\n\n  const setPopupPosition = () => {\n    if (annotation && popupRef.current) {\n      setPosition(getAnnotationPopupPositionBasedOn(annotation, popupRef, activeDocumentViewerKey, 5));\n    }\n  };\n\n  const contents = getLinkDestination(annotation, store) || '';\n\n  const handleUnLink = () => {\n    deleteLinkAnnotationWithGroup(annotation, activeDocumentViewerKey, core);\n    closePopup();\n    handleOnMouseLeave();\n  };\n\n  const className = classNames({\n    Popup: true,\n    LinkAnnotationPopupContainer: true,\n    open: isOpen,\n    closed: !isOpen,\n  });\n\n  const isAnnotation = annotation !== undefined;\n\n  return (\n    <DataElementWrapper\n      dataElement={DataElements.LINK_ANNOTATION_POPUP}\n      className={className}\n      style={{ ...position }}\n      ref={popupRef}\n    >\n      <LinkAnnotationPopup\n        linkText={contents}\n        handleUnLink={handleUnLink}\n        isAnnotation={isAnnotation}\n        isMobileDevice={isMobileSize()}\n        handleOnMouseEnter={handleOnMouseEnter}\n        handleOnMouseLeave={handleOnMouseLeave}\n        handleMouseMove={handleMouseMove}\n      />\n    </DataElementWrapper>\n\n  );\n};\n\nLinkAnnotationPopupContainer.propTypes = propTypes;\n\nexport default LinkAnnotationPopupContainer;","import LinkAnnotationPopupContainer from './LinkAnnotationPopupContainer';\n\nexport default LinkAnnotationPopupContainer;"],"sourceRoot":""}