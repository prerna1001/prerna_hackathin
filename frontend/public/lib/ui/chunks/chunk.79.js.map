{"version":3,"sources":["webpack:///./src/ui/src/components/ScaleOverlay/ScaleOverlay.scss?525c","webpack:///./src/ui/src/components/ScaleOverlay/ScaleSelector.js","webpack:///./src/ui/src/components/ScaleOverlay/ScaleHeader.js","webpack:///./src/ui/src/constants/measurementTypes.js","webpack:///./src/ui/src/helpers/getNumberOfDecimalPlaces.js","webpack:///./src/ui/src/helpers/getAngleInRadians.js","webpack:///./src/ui/src/helpers/getFormattedUnit.js","webpack:///./src/ui/src/components/MeasurementOverlay/LineMeasurementInput.js","webpack:///./src/ui/src/components/MeasurementOverlay/EllipseMeasurementOverlay.js","webpack:///./src/ui/src/components/ScaleOverlay/MeasurementDetail.js","webpack:///./src/ui/src/components/ScaleOverlay/CalibrationOverlay.js","webpack:///./src/ui/src/components/ScaleOverlay/ScaleOverlay.js","webpack:///./src/ui/src/components/ScaleOverlay/ScaleOverlayContainer.js"],"names":["module","exports","propTypes","scales","PropTypes","arrayOf","object","isRequired","selectedScales","string","onScaleSelected","func","onAddingNewScale","ariaLabelledBy","isScaleModalEnabled","bool","Scale","window","Core","ScaleSelector","_ref","_ref$scales","_ref$selectedScales","core","useCore","t","_slicedToArray","useTranslation","dispatch","useDispatch","_useState2","useState","scalesInfo","setScalesInfo","useEffect","length","getScalesInfo","isMultipleScalesMode","useSelector","state","selectors","getIsMultipleScalesMode","isMultipleScales","showScaleModal","coreScales","getScales","Object","keys","forEach","scale","coreScaleKey","toString","scaleData","measurements","relatedPages","Set","canDelete","measurementItem","Annotations","Annotation","add","push","canModify","some","info","title","measurementsNum","pages","_toConsumableArray","console","warn","concat","openScaleDeletionModal","scaleInfo","warning","message","React","createElement","className","join","confirmBtnText","onConfirm","deleteScale","actions","showWarningMessage","renderScale","precision","getScalePrecision","pageScaleStr","getFormattedValue","pageScale","value","unit","worldScaleStr","worldScale","scaleDisplay","selectedScale","_useState4","isDropDownOpen","setOpenDropDown","toggleDropdown","prevValue","selectorRef","useRef","useOnClickOutside","DataElementWrapper","dataElement","tabIndex","ref","onKeyDown","e","key","onClick","data-testid","aria-expanded","aria-labelledby","aria-controls","role","Icon","glyph","ariaHidden","id","classNames","map","includes","options","preventDefault","stopPropagation","disabled","aria-label","Button","label","ScaleHeader","onClickFocusWrapped","useFocusHandler","isDisabledViewOnly","DataElements","SCALE_MODAL","measurementTypeTranslationMap","distanceMeasurement","perimeterMeasurement","areaMeasurement","rectangularAreaMeasurement","cloudyRectangularAreaMeasurement","ellipseMeasurement","arcMeasurement","split","pt1","pt2","pt3","angle","AB","Math","sqrt","pow","x","y","BC","AC","acos","atan2","abs","PI","unitMap","LineMeasurementInput","annotation","isOpen","selectedTool","_selectedTool$Measure","isReadOnly","isViewOnly","factor","Measure","axis","DisplayUnits","getLineLength","toFixed","setLength","onInputChanged","event","target","validateLineLength","finishAnnotation","getTool","finish","selectAnnotation","getAnnotationManager","deselectAnnotation","Precision","ensureLineIsWithinBounds","forceLineRedraw","useCallback","annotationManager","drawAnnotations","PageNumber","trigger","getMaxLineLengthInPts","maxX","maxY","currentPageNumber","getCurrentPage","documentWidth","getPageWidth","documentHeight","getPageHeight","angleInDegrees","getAngle","startPoint","getStartPoint","startX","startY","maxLenX","cos","maxLenY","sin","min","lengthInPts","value1","value2","maxLengthInPts","setLineLength","getAnnotationUnit","_annotation$DisplayUn","annotUnit","onAngleChange","setAngle","angleInRadians","start","Start","endX","endY","setEndPoint","adjustRect","setLineAngle","computeAngle","onAnnotationChanged","addEventListener","removeEventListener","Fragment","type","autoFocus","isMobileDevice","onChange","onBlur","getFormattedUnit","max","getAngleInRadians","End","deltaX","deltaY","renderDeltas","props","propName","componentName","checkPropTypes","shape","number","getContents","Error","defaults","EllipseMeasurementOverlay","_annotation$getMeasur","_selectedTool$default","_ref2","_selectedTool$default2","isDocumentReadOnly","area","getMeasurementTextWithScaleAndUnits","call","data","refreshRadius","setRadius","computeRadius","onAnnotationDeselected","annotations","action","ensureDiameterIsWithinBounds","getWidth","decimalPlaces","getNumberOfDecimalPlaces","Width","onChangeRadiusLength","eventValue","radius","diameterInPts","rect","getRect","newRect","x1","y1","x2","y2","setHeight","setWidth","resize","forceEllipseRedraw","redrawAnnotation","getMaxDiameterInPts","boundingRect","width","height","Height","precisionFractions","validateDiameter","MeasurementDetail","icon","color","translationKey","useMemo","_selectedTool$default3","mapAnnotationToKey","mapToolNameToKey","name","getDataWithKey","Color","toHexString","StrokeColor","contents","keyDisplayNameMap","renderValue","Length","Radius","getIPathAnnotationPts","path","getPath","pts","filter","pt","apply","Angle","undefined","renderAngle","renderDetails","CalibrationOverlayPropTypes","tempScale","onCancelCalibrationMode","onApplyCalibration","CalibrationOverlay","_Scale$worldScale","isCalibrationPopupOpen","isElementOpen","canApplyCalibration","onMouseDown","data-element","onTouchStart","updateIsCalibration","disableToolElements","ScaleOverlay","forceUpdate","_useSelector2","getCalibrationInfo","getActiveToolName","shallowEqual","_useSelector2$","isCalibration","_useSelector2$$previo","previousToolName","isFractionalUnit","activeToolName","setScales","shouldShowMeasurementDetail","onScaleUpdated","newScales","updateScales","onCreateAnnotationWithNoScale","_measurementItem$Meas","has","totalScales","canModifyMeasurement","memo","measurementDataElements","array","ScaleOverlayContainer","isDisabled","isElementDisabled","SCALE_OVERLAY_CONTAINER","SCALE_OVERLAY","areToolsDisabledViewOnly","annotationToolNames","ToolName","isToolDisabledViewOnly","initialPosition","getScaleOverlayPosition","_useDraggablePosition","useDraggablePosition","position","handleDrag","handleStop","containerRef","setOverlayRef","initialOffset","dragBounds","resetPosition","useReducer","updateCalibrationInfo","setCustomElementOverrides","openScaleModal","setSelectedScale","openElements","setIsElementHidden","newScale","applyTo","scaleToDelete","getDocumentViewer","getMeasurementManager","getOldScalesToDeleteAfterApplying","createAndApplyScale","confirmScaleToDelete","setToolMode","deleteAnnotations","setIsAddingNewScale","isMobile","isMobileSize","MobilePopupWrapper","Draggable","bounds","onDrag","onStop","cancel","Overlay","open","closed","style","node","current"],"mappings":"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","file":"chunks/chunk.79.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"LEFT_HEADER_WIDTH\":\"41px\",\"RIGHT_HEADER_WIDTH\":\"41px\"};","import classNames from 'classnames';\nimport Icon from 'components/Icon';\nimport DataElementWrapper from 'components/DataElementWrapper';\nimport PropTypes from 'prop-types';\nimport React, { useState, useRef, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport actions from 'actions';\nimport { useDispatch, useSelector } from 'react-redux';\nimport selectors from 'selectors';\nimport useCore from 'hooks/useCore';\nimport useOnClickOutside from 'hooks/useOnClickOutside';\nimport Button from 'components/Button';\n\nconst propTypes = {\n  scales: PropTypes.arrayOf(PropTypes.object).isRequired,\n  selectedScales: PropTypes.arrayOf(PropTypes.string).isRequired,\n  onScaleSelected: PropTypes.func.isRequired,\n  onAddingNewScale: PropTypes.func.isRequired,\n  ariaLabelledBy: PropTypes.string,\n  isScaleModalEnabled: PropTypes.bool,\n};\n\nconst Scale = window.Core.Scale;\n\nconst ScaleSelector = ({ scales = [], selectedScales = [], onScaleSelected, onAddingNewScale, ariaLabelledBy, isScaleModalEnabled }) => {\n  const { core } = useCore();\n  const [t] = useTranslation();\n  const dispatch = useDispatch();\n\n  const [scalesInfo, setScalesInfo] = useState([]);\n\n  useEffect(() => {\n    if (!scales || scales.length === 0) {\n      setScalesInfo([]);\n      return;\n    }\n\n    const scalesInfo = getScalesInfo(scales || []);\n    setScalesInfo(scalesInfo);\n  }, [scales]);\n\n  const isMultipleScalesMode = useSelector((state) => selectors.getIsMultipleScalesMode(state));\n  const isMultipleScales = selectedScales.length > 1;\n  const showScaleModal = isScaleModalEnabled && isMultipleScalesMode;\n\n  const getScalesInfo = (scales) => {\n    const scalesInfo = [];\n    const coreScales = core.getScales();\n\n    if (!scales || scales.length === 0 || !coreScales || Object.keys(coreScales).length === 0) {\n      return scalesInfo;\n    }\n\n    scales.forEach((scale) => {\n      const coreScaleKey = scale.toString();\n      const scaleData = coreScales[coreScaleKey];\n\n      if (!scaleData || scaleData.length === 0) {\n        console.warn(`No measurements found for scale ${coreScaleKey}`);\n        return;\n      }\n\n      const measurements = [];\n      const relatedPages = new Set();\n      let canDelete = true;\n\n      scaleData.forEach((measurementItem) => {\n        const isAnnotation = measurementItem instanceof window.Core.Annotations.Annotation;\n        if (!isAnnotation) {\n          return;\n        }\n\n        relatedPages.add(measurementItem['PageNumber']);\n        measurements.push(measurementItem);\n\n        // If any associated measurement cannot be deleted then we won't allow this scale to be deleted.\n        if (!core.canModify(measurementItem)) {\n          canDelete = false;\n        }\n      });\n\n      const scalesInfoAlreadyHasScale = scalesInfo.some(\n        (info) => info.title === coreScaleKey,\n      );\n\n      if (scalesInfoAlreadyHasScale) {\n        return;\n      }\n\n      scalesInfo.push({\n        scale,\n        title: scale.toString(),\n        measurementsNum: measurements.length,\n        pages: [...relatedPages],\n        canDelete\n      });\n    });\n\n    return scalesInfo;\n  };\n\n  const openScaleDeletionModal = (scaleInfo) => {\n    if (!scaleInfo) {\n      return;\n    }\n\n    const hasAssociatedMeasurements = !!scaleInfo.pages.length;\n    const message = hasAssociatedMeasurements ? (\n      <div className='customMessage'>\n        <p>\n          <span>\n            {t('option.measurement.deleteScaleModal.scaleIsOn-delete-info')}\n            <b>{` ${t('option.measurement.deleteScaleModal.page-delete-info')} ${scaleInfo.pages.join(', ')} `}</b>\n            {t('option.measurement.deleteScaleModal.appliedTo-delete-info')}\n            <b>{` ${scaleInfo.measurementsNum} ${scaleInfo.measurementsNum > 1 ? t('option.measurement.deleteScaleModal.measurements') : t('option.measurement.deleteScaleModal.measurement')}.`}</b>\n          </span>\n          <span> </span>\n          <span>\n            {t('option.measurement.deleteScaleModal.deletionIs')}\n            <b>{` ${t('option.measurement.deleteScaleModal.irreversible')} `}</b>\n            {t('option.measurement.deleteScaleModal.willDeleteMeasurement')}\n          </span>\n        </p>\n        <p>\n          {t('option.measurement.deleteScaleModal.confirmDelete')}\n        </p>\n      </div>\n    ) : (\n      <div className='customMessage'>\n        <p>\n          <span>\n            {t('option.measurement.deleteScaleModal.confirmDelete')}\n            {t('option.measurement.deleteScaleModal.thisCantBeUndone')}\n          </span>\n        </p>\n      </div>\n    );\n    const title = `${t('option.measurement.deleteScaleModal.deleteScale')} ${scaleInfo.title}`;\n    const confirmBtnText = t('action.confirm');\n\n    const warning = {\n      message,\n      title,\n      confirmBtnText,\n      onConfirm: () => core.deleteScale(scaleInfo.scale)\n    };\n    dispatch(actions.showWarningMessage(warning));\n  };\n\n  const renderScale = (scale) => {\n    const precision = core.getScalePrecision(scale);\n    const pageScaleStr = Scale.getFormattedValue(scale.pageScale.value, scale.pageScale.unit, precision, false);\n    const worldScaleStr = Scale.getFormattedValue(scale.worldScale.value, scale.worldScale.unit, precision, false);\n    const scaleDisplay = `${pageScaleStr} = ${worldScaleStr}`;\n\n    return <div>{scaleDisplay}</div>;\n  };\n\n  let title = t('option.measurement.scaleOverlay.multipleScales');\n\n  if (selectedScales.length && !isMultipleScales) {\n    const selectedScale = new Scale(selectedScales[0]);\n    title = renderScale(selectedScale);\n  }\n\n  // TODO: This is a bandaid solution to fix a Safari bug. This dropdown should be refactored to use a react-select component\n  // instead of hiding and displaying based on focus pseudoclasses,\n  // otherwise it is hard to debug as the open/close logic is in a CSS stylesheet and not super evident\n  const [isDropDownOpen, setOpenDropDown] = useState(false);\n  const toggleDropdown = () => {\n    setOpenDropDown((prevValue) => !prevValue);\n  };\n\n  const selectorRef = useRef(null);\n\n  useOnClickOutside(selectorRef, () => {\n    setOpenDropDown(false);\n  });\n\n  const handleKeyDown = (e) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      toggleDropdown();\n    }\n  };\n\n  return (\n    <DataElementWrapper\n      className=\"scale-overlay-selector\"\n      dataElement=\"scaleSelector\"\n      tabIndex={-1}\n      ref={selectorRef}\n      onKeyDown={handleKeyDown}\n      onClick={toggleDropdown}\n    >\n      {/* Cleanup this <div> to a <select> https://apryse.atlassian.net/browse/WVR-7613 */}\n      <div\n        data-testid='scale-selector'\n        className=\"scale-overlay-selection\"\n        aria-expanded={isDropDownOpen}\n        aria-labelledby={ariaLabelledBy}\n        aria-controls=\"scale-overlay-dropdown\"\n        role=\"combobox\"\n        tabIndex={0}\n      >\n        <div className=\"scale-overlay-item\">\n          <div className=\"scale-overlay-name\">\n            {title}\n          </div>\n          <div className=\"scale-overlay-arrow\">\n            <Icon glyph=\"icon-chevron-down\" ariaHidden={true} />\n          </div>\n        </div>\n      </div>\n      {isDropDownOpen && (\n        <ul id=\"scale-overlay-dropdown\" className={classNames('scale-overlay-list')} >\n          <li>\n            <div className=\"scale-overlay-name\">{title}</div>\n            <div className=\"scale-overlay-arrow\">\n              <button\n                className=\"scale-overlay-selected-arrow\"\n              >\n                <Icon glyph=\"icon-chevron-up\" ariaHidden={true}/>\n              </button>\n            </div>\n          </li>\n          {scalesInfo.map((scaleInfo) => (\n            <li key={scaleInfo.title} className={classNames({\n              'className=\"scale-overlay-item': true,\n              'option-selected': selectedScales.includes(scaleInfo.title)\n            })}>\n              <button\n                className={classNames({\n                  options: true,\n                })}\n                onClick={() => onScaleSelected(selectedScales, scaleInfo.title)}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' || e.key === ' ') {\n                    e.preventDefault();\n                    onScaleSelected(selectedScales, scaleInfo.title);\n                  }\n                }}\n              >\n                {renderScale(scaleInfo.scale)}\n              </button>\n              <button\n                className=\"delete\"\n                tabIndex={0}\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  openScaleDeletionModal(scaleInfo);\n                }}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' || e.key === ' ') {\n                    e.preventDefault();\n                    openScaleDeletionModal(scaleInfo);\n                  }\n                }}\n                disabled={scalesInfo.length <= 1 || !scaleInfo.canDelete}\n                aria-label={`${t('action.delete')} ${scaleInfo.title}`}\n              >\n                <Icon glyph=\"icon-delete-line\" />\n              </button>\n            </li>\n          ))}\n          {showScaleModal && (\n            <li>\n              <Button onClick={onAddingNewScale} label={t('option.measurement.scaleOverlay.addNewScale')} className=\"add-new-scale\" />\n            </li>\n          )}\n        </ul>\n      )}\n    </DataElementWrapper>\n  );\n};\n\nScaleSelector.propTypes = propTypes;\n\nexport default ScaleSelector;\n","import React from 'react';\nimport Button from 'components/Button';\nimport Icon from 'components/Icon';\nimport ScaleSelector from './ScaleSelector';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport useFocusHandler from 'hooks/useFocusHandler';\nimport selectors from 'selectors';\nimport { useSelector } from 'react-redux';\nimport DataElements from 'src/constants/dataElement';\n\nconst propTypes = {\n  scales: PropTypes.arrayOf(PropTypes.object).isRequired,\n  selectedScales: PropTypes.arrayOf(PropTypes.string).isRequired,\n  onScaleSelected: PropTypes.func.isRequired,\n  onAddingNewScale: PropTypes.func.isRequired,\n};\n\nconst ScaleHeader = ({ scales, selectedScales, onScaleSelected, onAddingNewScale }) => {\n  const [t] = useTranslation();\n\n  const onClickFocusWrapped = useFocusHandler(onAddingNewScale);\n  const isScaleModalEnabled = useSelector((state) => !selectors.isDisabledViewOnly(state, DataElements.SCALE_MODAL));\n\n  return (\n    <div className=\"scale-overlay-header\">\n      <Icon glyph=\"ic-calibrate\" className=\"scale-overlay-icon\" />\n      <h4 id=\"scale-dropdown-label\" className=\"scale-overlay-title\">{t('option.measurementOption.scale')}</h4>\n      {scales.length ? (\n        <ScaleSelector\n          scales={scales}\n          selectedScales={selectedScales}\n          onScaleSelected={onScaleSelected}\n          onAddingNewScale={onAddingNewScale}\n          ariaLabelledBy=\"scale-dropdown-label\"\n          isScaleModalEnabled={isScaleModalEnabled}\n        />\n      ) : (\n        isScaleModalEnabled && (\n          <Button className=\"add-new-scale\" onClick={onClickFocusWrapped} dataElement=\"addNewScale\" label={t('option.measurement.scaleOverlay.addNewScale')} />\n        )\n      )}\n    </div>\n  );\n};\n\nScaleHeader.propTypes = propTypes;\nexport default ScaleHeader;\n","export const measurementTypeTranslationMap = {\n  distanceMeasurement: 'option.measurementOverlay.distanceMeasurement',\n  perimeterMeasurement: 'option.measurementOverlay.perimeterMeasurement',\n  areaMeasurement: 'option.measurementOverlay.areaMeasurement',\n  rectangularAreaMeasurement: 'option.measurementOverlay.areaMeasurement',\n  cloudyRectangularAreaMeasurement: 'option.measurementOverlay.areaMeasurement',\n  ellipseMeasurement: 'option.measurementOverlay.areaMeasurement',\n  arcMeasurement: 'option.measurementOverlay.arcMeasurement',\n};","export default (precision) => (precision === 1 ? 0 : precision?.toString().split('.')[1].length);\n","export default (pt1, pt2, pt3) => {\n  let angle;\n\n  if (pt1 && pt2) {\n    if (pt3) {\n      // calculate the angle using Law of cosines\n      const AB = Math.sqrt(Math.pow(pt2.x - pt1.x, 2) + Math.pow(pt2.y - pt1.y, 2));\n      const BC = Math.sqrt(Math.pow(pt2.x - pt3.x, 2) + Math.pow(pt2.y - pt3.y, 2));\n      const AC = Math.sqrt(Math.pow(pt3.x - pt1.x, 2) + Math.pow(pt3.y - pt1.y, 2));\n      angle = Math.acos((BC * BC + AB * AB - AC * AC) / (2 * BC * AB));\n    } else {\n      // if there are only two points returns the angle in the plane (in radians) between the positive x-axis and the ray from (0,0) to the point (x,y)\n      angle = Math.atan2(pt2.y - pt1.y, pt2.x - pt1.x);\n      // keep the angle range between 0 and Math.PI / 2\n      angle = Math.abs(angle);\n      angle = angle > Math.PI / 2 ? Math.PI - angle : angle;\n    }\n  }\n\n  return angle;\n};\n","export default (unit) => {\n  switch (unit) {\n    case 'ft\\'':\n      return 'ft';\n    case 'in\"':\n      return 'in';\n    case 'ft-in':\n      return 'ft';\n    default:\n      return unit;\n  }\n};\n","import React, { useEffect, useState, useCallback } from 'react';\nimport { useSelector } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport useCore from 'hooks/useCore';\nimport { isMobileDevice } from 'helpers/device';\nimport selectors from 'selectors';\nimport getAngleInRadians from 'helpers/getAngleInRadians';\nimport getFormattedUnit from 'helpers/getFormattedUnit';\n\nconst unitMap = {\n  'in\\\"': 'in',\n  'ft\\'': 'ft'\n};\n\nLineMeasurementInput.propTypes = {\n  annotation: PropTypes.object,\n  isOpen: PropTypes.bool.isRequired,\n  selectedTool: PropTypes.object,\n  canModify: PropTypes.bool,\n};\n\nconst Scale = window.Core.Scale;\n\nfunction LineMeasurementInput({ annotation, isOpen, selectedTool, canModify }) {\n  const { core } = useCore();\n  const [t] = useTranslation();\n  const isReadOnly = useSelector((state) => selectors.isViewOnly(state));\n  const factor = annotation?.Measure.axis[0].factor;\n  const unit = annotation?.DisplayUnits[0] || selectedTool?.Measure?.unit;\n  const [length, setLength] = useState((annotation?.getLineLength() * factor || 0).toFixed(2));\n\n  const onInputChanged = (event) => {\n    setLength(event.target.value);\n    validateLineLength(event);\n    finishAnnotation();\n  };\n\n  const finishAnnotation = () => {\n    const tool = core.getTool('AnnotationCreateDistanceMeasurement');\n    tool.finish();\n  };\n\n  const selectAnnotation = () => {\n    const annotationManager = core.getAnnotationManager();\n    annotationManager.selectAnnotation(annotation);\n  };\n\n  const deselectAnnotation = () => {\n    const annotationManager = core.getAnnotationManager();\n    annotationManager.deselectAnnotation(annotation);\n  };\n\n  const validateLineLength = (event) => {\n    if (!annotation) {\n      return;\n    }\n    let length = Math.abs(event.target.value);\n    if (length < annotation.Precision) {\n      length = annotation.Precision;\n      setLength(length);\n    }\n    const factor = annotation.Measure.axis[0].factor;\n    const lengthInPts = length / factor;\n    ensureLineIsWithinBounds(lengthInPts);\n  };\n\n  const isApproximatelyEqual = (value1, value2) => {\n    return Math.abs(value1 - value2) < 0.1;\n  };\n\n  const forceLineRedraw = useCallback(() => {\n    const annotationManager = core.getAnnotationManager();\n    annotationManager.drawAnnotations(annotation.PageNumber);\n    annotationManager.trigger('annotationChanged', [[annotation], 'modify', {}]);\n  }, [annotation]);\n\n  const getMaxLineLengthInPts = useCallback(() => {\n    const currentPageNumber = core.getCurrentPage();\n    const documentWidth = core.getPageWidth(currentPageNumber);\n    const documentHeight = core.getPageHeight(currentPageNumber);\n    const angleInDegrees = annotation.getAngle() * (180 / Math.PI).toFixed(2);\n    const startPoint = annotation.getStartPoint();\n    const startX = startPoint.x;\n    const startY = startPoint.y;\n\n    let maxX;\n    let maxY;\n    if (Math.abs(angleInDegrees) < 90) {\n      maxX = documentWidth;\n    } else {\n      maxX = 0;\n    }\n\n    if (angleInDegrees > 0) {\n      maxY = documentHeight;\n    } else {\n      maxY = 0;\n    }\n\n    const maxLenX = Math.abs((maxX - startX) / Math.cos(annotation.getAngle()));\n    const maxLenY = Math.abs((maxY - startY) / Math.sin(annotation.getAngle()));\n\n    return Math.min(maxLenX, maxLenY);\n  }, [annotation]);\n\n\n  const ensureLineIsWithinBounds = useCallback(\n    (lengthInPts) => {\n      if (!isApproximatelyEqual(annotation.getLineLength(), lengthInPts)) {\n        const maxLengthInPts = getMaxLineLengthInPts();\n        annotation.setLineLength(Math.min(maxLengthInPts, lengthInPts));\n        forceLineRedraw();\n      }\n    },\n    [annotation, forceLineRedraw, getMaxLineLengthInPts],\n  );\n\n  const getAnnotationUnit = (annotation) => {\n    let annotUnit;\n    if (annotation?.DisplayUnits?.length) {\n      if (annotation.DisplayUnits.length === 2 && annotation.DisplayUnits[0] === \"ft'\" && annotation.DisplayUnits[1] === 'in\"') {\n        annotUnit = 'in';\n      } else {\n        annotUnit = annotation.DisplayUnits[0];\n      }\n    }\n    return unitMap[annotUnit] || annotUnit || unitMap[unit] || unit;\n  };\n\n  const renderDeltas = () => {\n    const angle = (annotation && getAngleInRadians(annotation.Start, annotation.End)) || 0;\n    const unit = getAnnotationUnit(annotation);\n    const deltaX = Scale.getFormattedValue(annotation && Math.abs(length * Math.cos(angle)), unit, annotation?.Precision);\n    const deltaY = Scale.getFormattedValue(annotation && Math.abs(length * Math.sin(angle)), unit, annotation?.Precision);\n\n    return (\n      <>\n        <div className=\"measurement__detail-item\">\n          <div className=\"measurement_list\">{t('option.measurementOverlay.xAxis')}:</div>\n          <div className='measurement'>\n            {deltaX}\n          </div>\n        </div>\n        <div className=\"measurement__detail-item\">\n          <div className=\"measurement_list\">{t('option.measurementOverlay.yAxis')}:</div>\n          <div className='measurement'>\n            {deltaY}\n          </div>\n        </div>\n      </>\n    );\n  };\n\n  const setLineAngle = (event) => {\n    const angle = event.target.value;\n    const angleInRadians = angle * (Math.PI / 180) * -1;\n    const lengthInPts = annotation.getLineLength();\n    const start = annotation.Start;\n    const endX = Math.cos(angleInRadians) * lengthInPts + start.x;\n    const endY = Math.sin(angleInRadians) * lengthInPts + start.y;\n    annotation.setEndPoint(endX, endY);\n    annotation.adjustRect();\n    forceLineRedraw();\n  };\n\n  const onAngleChange = (event) => {\n    setAngle(event.target.value);\n    setLineAngle(event);\n    finishAnnotation();\n  };\n\n  const computeAngle = useCallback(() => {\n    if (!annotation) {\n      return 0;\n    }\n    let angleInRadians = annotation.getAngle();\n    // Multiply by -1 to achieve 0-360 degrees counterclockwise\n    angleInRadians *= -1;\n    angleInRadians = angleInRadians < 0 ? angleInRadians + 2 * Math.PI : angleInRadians;\n    return ((angleInRadians / Math.PI) * 180).toFixed(2);\n  }, [annotation]);\n\n  const [angle, setAngle] = useState(computeAngle());\n\n  useEffect(() => {\n    if (!isOpen) {\n      ensureLineIsWithinBounds(annotation.getLineLength());\n    }\n  }, [annotation, ensureLineIsWithinBounds, isOpen]);\n\n  useEffect(() => {\n    if (!annotation) {\n      setAngle(computeAngle());\n      return;\n    }\n    const onAnnotationChanged = () => {\n      setLength((annotation.getLineLength() * factor).toFixed(2));\n      setAngle(computeAngle());\n    };\n    core.addEventListener('mouseMove', onAnnotationChanged);\n\n    return () => {\n      core.removeEventListener('mouseMove', onAnnotationChanged);\n    };\n  }, [annotation, computeAngle, factor, selectedTool]);\n\n  return (\n    <>\n      <div className=\"measurement__detail-item\">\n        <div className=\"measurement_list\">\n          {t('option.measurementOverlay.distance')}:\n        </div>\n        <input\n          className=\"scale-input\"\n          type=\"number\"\n          min=\"0\"\n          disabled={isReadOnly || !annotation || !canModify}\n          value={!annotation ? 0 : length}\n          autoFocus={!isMobileDevice}\n          onChange={(event) => {\n            onInputChanged(event);\n            selectAnnotation();\n          }}\n          onBlur={(event) => {\n            validateLineLength(event);\n          }}\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              onInputChanged(event);\n              deselectAnnotation();\n            }\n          }}\n        />\n        {getFormattedUnit(unit)}\n      </div>\n      <div className=\"measurement__detail-item\">\n        <div className=\"measurement_list\">{t('option.measurementOverlay.angle')}:</div>\n        <input\n          className=\"scale-input\"\n          type=\"number\"\n          min=\"0\"\n          max=\"360\"\n          disabled={isReadOnly || !annotation || !canModify}\n          value={angle}\n          autoFocus={!isMobileDevice}\n          onChange={(event) => {\n            onAngleChange(event);\n            selectAnnotation();\n          }}\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              onAngleChange(event);\n              deselectAnnotation();\n            }\n          }}\n        />\n            &deg;\n      </div>\n      {renderDeltas()}\n    </>\n  );\n}\n\nexport default LineMeasurementInput;\n","import useCore from 'hooks/useCore';\nimport getNumberOfDecimalPlaces from 'helpers/getNumberOfDecimalPlaces';\nimport { isMobileDevice } from 'src/helpers/device';\nimport { precisionFractions } from 'constants/measurementScale';\nimport PropTypes from 'prop-types';\nimport selectors from 'selectors';\nimport { useSelector } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport React, { useState, useEffect, useCallback } from 'react';\nimport getFormattedUnit from 'src/helpers/getFormattedUnit';\n\nconst propTypes = {\n  annotation: (props, propName, componentName) => {\n    if (!props.annotation && !props.selectedTool) {\n      return new Error(`One of props 'annotation' or 'selectedTool' was not specified in '${componentName}'.`);\n    }\n    if (props.annotation) {\n      PropTypes.checkPropTypes(\n        {\n          annotation: PropTypes.shape({\n            Precision: PropTypes.number,\n            DisplayUnits: PropTypes.arrayOf(PropTypes.string),\n            getContents: PropTypes.func,\n          }),\n        },\n        { annotation: props.annotation },\n        'prop',\n        'EllipseMeasurementOverlay',\n      );\n    }\n    return null;\n  },\n  selectedTool: (props, propName, componentName) => {\n    if (!props.annotation && !props.selectedTool) {\n      return new Error(`One of props 'annotation' or 'selectedTool' was not specified in '${componentName}'.`);\n    }\n    if (props.selectedTool) {\n      PropTypes.checkPropTypes(\n        {\n          selectedTool: PropTypes.shape({\n            defaults: PropTypes.shape({\n              Precision: PropTypes.number,\n            }),\n            Measure: PropTypes.shape({\n              unit: PropTypes.string,\n            }),\n          }),\n        },\n        { selectedTool: props.selectedTool },\n        'prop',\n        'EllipseMeasurementOverlay',\n      );\n    }\n    return null;\n  },\n  isOpen: PropTypes.bool.isRequired,\n  canModify: PropTypes.bool,\n};\n\nfunction EllipseMeasurementOverlay({ annotation, isOpen, selectedTool, canModify }) {\n  const { core } = useCore();\n  const { t } = useTranslation();\n\n  const isReadOnly = useSelector((state) => selectors.isDocumentReadOnly(state));\n  const area = annotation?.getMeasurementTextWithScaleAndUnits?.() || 0;\n  const data = {\n    precision: !annotation ? selectedTool?.defaults?.Precision : annotation.Precision,\n    unit: getFormattedUnit((annotation?.Scale || selectedTool?.defaults?.Scale)?.[1][1]),\n    area,\n  };\n\n  const refreshRadius = () => {\n    setRadius(computeRadius());\n  };\n\n  useEffect(() => {\n    refreshRadius();\n    core.addEventListener('mouseMove', refreshRadius);\n\n    return () => {\n      core.removeEventListener('mouseMove', refreshRadius);\n    };\n  }, [annotation]);\n\n  useEffect(() => {\n    const onAnnotationDeselected = (annotations, action) => {\n      if (action === 'deselected') {\n        const annotation = annotations[0];\n        ensureDiameterIsWithinBounds(annotation.getWidth(), annotation);\n      }\n    };\n\n    core.addEventListener('annotationSelected', onAnnotationDeselected);\n\n    return () => {\n      core.removeEventListener('annotationSelected', onAnnotationDeselected);\n    };\n  }, []);\n\n  const computeRadius = () => {\n    if (!annotation) {\n      return 0;\n    }\n    const decimalPlaces = annotation && getNumberOfDecimalPlaces(annotation.Precision) || 0;\n    const factor = annotation.Measure.axis[0].factor;\n    const radiusInPts = (annotation.Width / 2).toFixed(decimalPlaces);\n    return (radiusInPts * factor).toFixed(decimalPlaces);\n  };\n\n  const finishAnnotation = () => {\n    const tool = core.getTool('AnnotationCreateEllipseMeasurement');\n    tool.finish();\n  };\n\n  const selectAnnotation = () => {\n    const annotationManager = core.getAnnotationManager();\n    annotationManager.selectAnnotation(annotation);\n  };\n\n  const deselectAnnot = () => {\n    const annotationManager = core.getAnnotationManager();\n    annotationManager.deselectAnnotation(annotation);\n  };\n\n  const onChangeRadiusLength = (event) => {\n    const eventValue = event.target.value || 0;\n    const radius = eventValue > 0 ? eventValue : 0.0001;\n    const factor = annotation.Measure.axis[0].factor;\n    const radiusInPts = radius / factor;\n    const diameterInPts = radiusInPts * 2;\n    const rect = annotation.getRect();\n    let { X1, X2, Y1, Y2 } = 0;\n    X1 = rect['x1'];\n    Y1 = rect['y1'];\n    X2 = rect['x1'] + diameterInPts;\n    Y2 = rect['y1'] + diameterInPts;\n    const newRect = { x1: X1, y1: Y1, x2: X2, y2: Y2 };\n\n    annotation.setHeight(diameterInPts);\n    annotation.setWidth(diameterInPts);\n    annotation.resize(newRect);\n    setRadius(radius);\n    forceEllipseRedraw(annotation);\n    finishAnnotation();\n  };\n\n  const forceEllipseRedraw = (annotation) => {\n    const annotationManager = core.getAnnotationManager();\n    annotationManager.redrawAnnotation(annotation);\n    annotationManager.trigger('annotationChanged', [[annotation], 'modify', []]);\n  };\n\n  const getMaxDiameterInPts = useCallback((annotation) => {\n    const currentPageNumber = core.getCurrentPage();\n    const documentWidth = core.getPageWidth(currentPageNumber);\n    const documentHeight = core.getPageHeight(currentPageNumber);\n    const startX = annotation['X'];\n    const startY = annotation['Y'];\n\n    const maxX = documentWidth - startX;\n    const maxY = documentHeight - startY;\n\n    return Math.min(maxX, maxY);\n  });\n\n  const validateDiameter = (event) => {\n    const radius = Math.abs(event.target.value);\n    const factor = annotation.Measure.axis[0].factor;\n    const radiusInPts = radius / factor;\n    const diameterInPts = radiusInPts * 2;\n    ensureDiameterIsWithinBounds(diameterInPts, annotation);\n    refreshRadius();\n  };\n\n  const ensureDiameterIsWithinBounds = useCallback((diameterInPts, annotation) => {\n    const maxDiameterInPts = getMaxDiameterInPts(annotation);\n\n    if (diameterInPts > maxDiameterInPts) {\n      const boundingRect = annotation.getRect();\n      const { x1, x2, y1, y2 } = boundingRect;\n      let width = annotation.Width;\n      let height = annotation.Height;\n      const currentPageNumber = core.getCurrentPage();\n      const documentWidth = core.getPageWidth(currentPageNumber);\n      const documentHeight = core.getPageHeight(currentPageNumber);\n\n      if (x2 > documentWidth) {\n        boundingRect['x2'] = documentWidth;\n        width = documentWidth - x1;\n      }\n      if (y2 > documentHeight) {\n        boundingRect['y2'] = documentHeight;\n        height = documentHeight - y1;\n      }\n\n      if (width < documentWidth) {\n        annotation.setWidth(width);\n      } else {\n        annotation.setWidth(documentWidth);\n      }\n      if (height < documentHeight) {\n        annotation.setHeight(height);\n      } else {\n        annotation.setHeight(documentHeight);\n      }\n      annotation.resize(boundingRect);\n      forceEllipseRedraw(annotation);\n    }\n  }, [getMaxDiameterInPts]);\n\n  useEffect(() => {\n    if (!isOpen) {\n      ensureDiameterIsWithinBounds(annotation.getWidth(), annotation);\n    }\n  }, [annotation, ensureDiameterIsWithinBounds, isOpen]);\n\n  const [radius, setRadius] = useState(computeRadius());\n\n  return (\n    <div className=\"measurement__detail-container\">\n      <div className=\"measurement__detail-item\">\n        <div className=\"measurement_list\">{t('option.shared.precision')}:</div>\n        <div className='measurement'>\n          {precisionFractions[data.precision] || data.precision}\n        </div>\n      </div>\n      <div className=\"measurement__detail-item\">\n        <div className=\"measurement_list\">{t('option.measurementOverlay.area')}:</div>\n        <div className='measurement'>\n          {data.area}\n        </div>\n      </div>\n      <div className=\"measurement__detail-item\">\n        <div className=\"measurement_list\">{t('option.measurementOverlay.radius')}:</div>\n        <input\n          autoFocus={!isMobileDevice}\n          className=\"scale-input\"\n          type=\"number\"\n          min=\"0\"\n          disabled={isReadOnly || !annotation || !canModify}\n          value={radius}\n          onChange={(event) => {\n            onChangeRadiusLength(event);\n            selectAnnotation();\n          }}\n          onBlur={(event) => validateDiameter(event)}\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              onChangeRadiusLength(event);\n              deselectAnnot();\n            }\n          }}\n        />\n        {data.unit}\n      </div>\n    </div>\n  );\n}\n\nEllipseMeasurementOverlay.propTypes = propTypes;\n\nexport default EllipseMeasurementOverlay;\n","import React, { useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport { mapAnnotationToKey, mapToolNameToKey, getDataWithKey } from 'constants/map';\nimport { measurementTypeTranslationMap } from 'constants/measurementTypes';\nimport { precisionFractions } from 'constants/measurementScale';\nimport getNumberOfDecimalPlaces from 'helpers/getNumberOfDecimalPlaces';\nimport Icon from 'components/Icon';\nimport LineMeasurementInput from 'components/MeasurementOverlay/LineMeasurementInput';\nimport EllipseMeasurementOverlay from 'components/MeasurementOverlay/EllipseMeasurementOverlay';\nimport getAngleInRadians from 'helpers/getAngleInRadians';\n\nimport './ScaleOverlay.scss';\n\nconst propTypes = {\n  annotation: PropTypes.object,\n  isOpen: PropTypes.bool.isRequired,\n  selectedTool: PropTypes.object,\n  canModify: PropTypes.bool,\n};\n\nconst MeasurementDetail = ({ annotation, isOpen, selectedTool, canModify }) => {\n  const { t } = useTranslation();\n\n  const data = useMemo(() => {\n    const key = annotation ? mapAnnotationToKey(annotation) : mapToolNameToKey(selectedTool.name);\n\n    return {\n      key,\n      icon: getDataWithKey(key).icon,\n      color: annotation ? annotation.Color.toHexString() : selectedTool?.defaults?.StrokeColor?.toHexString(),\n      contents: annotation ? annotation.getMeasurementTextWithScaleAndUnits?.() : 0,\n      precision: !annotation ? selectedTool?.defaults?.Precision : annotation.Precision,\n    };\n  });\n\n  const renderTitle = () => {\n    const { key, icon, color } = data;\n    const translationKey = measurementTypeTranslationMap[key];\n\n    return (\n      <div className=\"header\">\n        <Icon glyph={icon} color={color} className=\"icon\" />\n        <div>{t(translationKey)}</div>\n      </div>\n    );\n  };\n\n  const renderValue = () => {\n    const { key, contents } = data;\n\n    const keyDisplayNameMap = {\n      distanceMeasurement: t('option.measurementOverlay.distance'),\n      perimeterMeasurement: t('option.measurementOverlay.perimeter'),\n      areaMeasurement: t('option.measurementOverlay.area'),\n      rectangularAreaMeasurement: t('option.measurementOverlay.area'),\n      cloudyRectangularAreaMeasurement: t('option.measurementOverlay.area'),\n    };\n\n    return (\n      <div className=\"measurement__detail-item\">\n        <div className=\"measurement_list\">{keyDisplayNameMap[key]}:</div>\n        <div className=\"measurement\">\n          {contents}\n        </div>\n      </div>\n    );\n  };\n\n  const renderAngle = () => {\n    if (!annotation) {\n      return (\n        <div className=\"measurement__detail-item\">\n          <div className=\"measurement_list\">{t('option.measurementOverlay.angle')}:</div>\n          <div className=\"measurement\">\n            0&deg;\n          </div>\n        </div>\n      );\n    }\n    const { key } = data;\n    const getIPathAnnotationPts = (annotation) => {\n      const path = annotation.getPath();\n      const length = path.length;\n      return [path[length - 3], path[length - 2], path[length - 1]];\n    };\n    const keyPtMap = {\n      distanceMeasurement: ({ Start, End }) => [Start, End],\n      perimeterMeasurement: getIPathAnnotationPts,\n      areaMeasurement: getIPathAnnotationPts,\n      rectangularAreaMeasurement: getIPathAnnotationPts,\n      cloudyRectangularAreaMeasurement: getIPathAnnotationPts,\n      arcMeasurement: getIPathAnnotationPts,\n    };\n    const pts = keyPtMap[key](annotation).filter((pt) => !!pt);\n\n    let angle = getAngleInRadians(...pts) || 0;\n    if (angle) {\n      const decimalPlaces = getNumberOfDecimalPlaces(annotation.Precision);\n      angle = ((angle / Math.PI) * 180).toFixed(decimalPlaces);\n    }\n\n    if (key === 'arcMeasurement') {\n      angle = annotation.Angle.toFixed(2);\n    }\n\n    return (\n      angle !== undefined && (\n        <div className=\"measurement__detail-item\">\n          <div className=\"measurement_list\">{t('option.measurementOverlay.angle')}:</div>\n          <div className=\"measurement\">\n            {angle}&deg;\n          </div>\n        </div>\n      )\n    );\n  };\n\n  const renderLength = () => {\n    const length = annotation?.Length || 0;\n    return (\n      <div className=\"measurement__detail-item\">\n        <div className=\"measurement_list\">{t('option.measurementOverlay.length')}</div>\n        <div className=\"measurement\">\n          {length}\n        </div>\n      </div>\n    );\n  };\n\n  const renderRadius = () => {\n    const radius = annotation?.Radius || 0;\n    return (\n      <div className=\"measurement__detail-item\">\n        <div className=\"measurement_list\">{t('option.measurementOverlay.radius')}</div>\n        <div className=\"measurement\">\n          {radius}\n        </div>\n      </div>\n    );\n  };\n\n  const renderDetails = () => {\n    const { key, precision } = data;\n    if (key === 'ellipseMeasurement') {\n      return <EllipseMeasurementOverlay annotation={annotation} selectedTool={selectedTool} isOpen={isOpen} canModify={canModify} />;\n    }\n\n    return (\n      <div className=\"measurement__detail-container\">\n        <div className=\"measurement__detail-item\">\n          <div className=\"measurement_list\">{t('option.shared.precision')}:</div>\n          <div className=\"measurement\">\n            {precisionFractions[precision] || precision}\n          </div>\n        </div>\n        {key === 'distanceMeasurement' && (\n          <LineMeasurementInput annotation={annotation} isOpen={isOpen} selectedTool={selectedTool} canModify={canModify} />\n        )}\n        {[\n          'rectangularAreaMeasurement',\n          'cloudyRectangularAreaMeasurement',\n          'perimeterMeasurement',\n          'areaMeasurement',\n        ].includes(key) && renderValue()}\n        {key === 'arcMeasurement' && renderLength()}\n        {key === 'arcMeasurement' && renderRadius()}\n        {!['rectangularAreaMeasurement', 'distanceMeasurement', 'cloudyRectangularAreaMeasurement'].includes(key) &&\n          renderAngle()}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"MeasurementDetail\">\n      {renderTitle()}\n      {renderDetails()}\n    </div>\n  );\n};\n\nMeasurementDetail.propTypes = propTypes;\n\nexport default MeasurementDetail;\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { useSelector } from 'react-redux';\nimport selectors from 'selectors';\nimport Icon from 'components/Icon';\nimport PropTypes from 'prop-types';\n\nconst Scale = window.Core.Scale;\n\nconst CalibrationOverlayPropTypes = {\n  tempScale: PropTypes.string,\n  onCancelCalibrationMode: PropTypes.func,\n  onApplyCalibration: PropTypes.func\n};\n\nconst CalibrationOverlay = ({ tempScale, onCancelCalibrationMode, onApplyCalibration }) => {\n  const [t] = useTranslation();\n\n  const isCalibrationPopupOpen = useSelector((state) => selectors.isElementOpen(state, 'annotationPopup'));\n\n  const canApplyCalibration = isCalibrationPopupOpen && tempScale;\n\n  return (\n    <div className=\"scale-overlay-calibrate\">\n      <div className=\"scale-overlay-header\">\n        <Icon glyph=\"ic-calibrate\" className=\"scale-overlay-icon\" />\n        <div className=\"scale-overlay-title\">{t('option.measurement.scaleModal.calibrate')}</div>\n      </div>\n      <div className=\"scale-overlay-content\">\n        {!canApplyCalibration\n          ? t('option.measurement.scaleOverlay.selectTwoPoints')\n          : t('option.measurement.scaleOverlay.inputKnowDimension')}\n      </div>\n      <div className=\"divider\" />\n      <div className=\"scale-overlay-footer\">\n        <button\n          className=\"calibration-cancel\"\n          onMouseDown={onCancelCalibrationMode}\n        >\n          {t('action.cancel')}\n        </button>\n        <button\n          className=\"calibration-apply\"\n          disabled={!(isCalibrationPopupOpen && tempScale && (new Scale(tempScale).worldScale?.value > 0))}\n          data-element=\"calibrationApply\"\n          onMouseDown={onApplyCalibration}\n          onTouchStart={onApplyCalibration}\n        >\n          {t('action.apply')}\n        </button>\n      </div>\n    </div>\n  );\n};\n\nCalibrationOverlay.propTypes = CalibrationOverlayPropTypes;\n\nexport default CalibrationOverlay;","import ScaleHeader from './ScaleHeader';\nimport useCore from 'hooks/useCore';\nimport MeasurementDetail from './MeasurementDetail';\nimport PropTypes from 'prop-types';\nimport selectors from 'selectors';\nimport React, { useEffect, useState, useMemo, memo } from 'react';\nimport { useSelector, shallowEqual } from 'react-redux';\nimport CalibrationOverlay from './CalibrationOverlay';\n\nimport './ScaleOverlay.scss';\n\nconst Scale = window.Core.Scale;\n\nconst propTypes = {\n  annotations: PropTypes.arrayOf(PropTypes.object).isRequired,\n  selectedTool: PropTypes.object,\n  updateIsCalibration: PropTypes.func.isRequired,\n  disableToolElements: PropTypes.func.isRequired,\n  onScaleSelected: PropTypes.func.isRequired,\n  onCancelCalibrationMode: PropTypes.func.isRequired,\n  onApplyCalibration: PropTypes.func.isRequired,\n  onAddingNewScale: PropTypes.func.isRequired\n};\n\nconst ScaleOverlay = ({\n  annotations,\n  selectedTool,\n  updateIsCalibration,\n  disableToolElements,\n  onScaleSelected,\n  onCancelCalibrationMode,\n  onApplyCalibration,\n  onAddingNewScale,\n  forceUpdate,\n}) => {\n  const [\n    { isCalibration, tempScale, previousToolName = 'AnnotationCreateDistanceMeasurement', isFractionalUnit },\n    activeToolName\n  ] = useSelector((state) => [\n    selectors.getCalibrationInfo(state),\n    selectors.getActiveToolName(state)\n  ], shallowEqual);\n  const { core } = useCore();\n  const [scales, setScales] = useState(core.getScales());\n  const shouldShowMeasurementDetail = !!Object.keys(scales).length && !(!selectedTool && (!annotations.length || annotations.length > 1));\n\n  useEffect(() => {\n    forceUpdate();\n  }, [scales]);\n\n  useEffect(() => {\n    const onScaleUpdated = (newScales) => {\n      setScales(newScales);\n    };\n    const updateScales = () => {\n      setScales(core.getScales());\n    };\n\n    const onCreateAnnotationWithNoScale = () => {\n      onAddingNewScale();\n    };\n    core.addEventListener('scaleUpdated', onScaleUpdated);\n    core.addEventListener('createAnnotationWithNoScale', onCreateAnnotationWithNoScale);\n    core.addEventListener('annotationsLoaded', updateScales);\n    core.addEventListener('annotationChanged', updateScales);\n\n    return () => {\n      core.removeEventListener('scaleUpdated', onScaleUpdated);\n      core.removeEventListener('createAnnotationWithNoScale', onCreateAnnotationWithNoScale);\n      core.removeEventListener('annotationsLoaded', updateScales);\n      core.removeEventListener('annotationChanged', updateScales);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (activeToolName === 'AnnotationCreateCalibrationMeasurement') {\n      !isCalibration && updateIsCalibration(true);\n      disableToolElements(true);\n    } else {\n      updateIsCalibration(false);\n      disableToolElements(false);\n    }\n  }, [activeToolName, updateIsCalibration, disableToolElements]);\n\n  const selectedScales = useMemo(() => {\n    const scales = new Set();\n    [...annotations, selectedTool].forEach((measurementItem) => {\n      const scale = measurementItem?.Measure?.scale;\n      if (scale && !scales.has(scale)) {\n        scales.add(scale);\n      }\n    });\n    return [...scales];\n  }, [annotations, selectedTool, scales]);\n\n  const totalScales = Object.keys(scales).map((scale) => new Scale(scale));\n  const canModifyMeasurement = annotations.length === 1 ? core.canModify(annotations[0]) : false;\n\n  return isCalibration ? (\n    <CalibrationOverlay\n      tempScale={tempScale}\n      onCancelCalibrationMode={() => onCancelCalibrationMode(previousToolName)}\n      onApplyCalibration={() => onApplyCalibration(previousToolName, tempScale, isFractionalUnit)}\n      previousToolName={previousToolName}\n    />\n  ) : (\n    <>\n      <ScaleHeader\n        scales={totalScales}\n        selectedScales={selectedScales}\n        onScaleSelected={onScaleSelected}\n        onAddingNewScale={onAddingNewScale}\n      />\n      {shouldShowMeasurementDetail && (\n        <MeasurementDetail\n          annotation={annotations.length > 1 ? null : annotations[0] || null}\n          selectedTool={selectedTool}\n          isOpen\n          canModify={canModifyMeasurement}\n        />\n      )}\n    </>\n  );\n};\n\nScaleOverlay.propTypes = propTypes;\n\nexport default memo(ScaleOverlay);\n","import actions from 'actions';\nimport ScaleOverlay from './ScaleOverlay';\nimport classNames from 'classnames';\nimport useCore from 'hooks/useCore';\nimport Draggable from 'react-draggable';\nimport selectors from 'selectors';\nimport { useSelector, useDispatch } from 'react-redux';\nimport React, { useCallback, useReducer, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport DataElements from 'constants/dataElement';\nimport useDraggablePosition from '../../hooks/useDraggablePosition';\nimport PropTypes from 'prop-types';\n\nimport './ScaleOverlay.scss';\n\nimport MobilePopupWrapper from '../MobilePopupWrapper';\nimport { isMobileSize } from 'helpers/getDeviceSize';\n\nconst Scale = window.Core.Scale;\n\nconst measurementDataElements = [\n  'distanceToolGroupButton',\n  'arcMeasurementToolGroupButton',\n  'perimeterToolGroupButton',\n  'areaToolGroupButton',\n  'rectangleAreaToolGroupButton',\n  'ellipseAreaToolGroupButton',\n  'countToolGroupButton',\n  'cloudyRectangleAreaToolGroupButton',\n  'arcToolGroupButton'\n];\n\nconst propTypes = {\n  annotations: PropTypes.array,\n  selectedTool: PropTypes.object,\n};\n\nconst ScaleOverlayContainer = ({ annotations, selectedTool }) => {\n  const { core } = useCore();\n  const dispatch = useDispatch();\n  const [t] = useTranslation();\n  const isDisabled = useSelector((state) => selectors.isElementDisabled(state, DataElements.SCALE_OVERLAY_CONTAINER));\n  const isDisabledViewOnly = useSelector((state) => selectors.isDisabledViewOnly(state, DataElements.SCALE_OVERLAY));\n  const areToolsDisabledViewOnly = useSelector((state) => {\n    const annotationToolNames = [...new Set(annotations.map((annotation) => annotation.ToolName))];\n    const toolNames = annotationToolNames.length > 0 ? annotationToolNames : [selectedTool?.name];\n    return toolNames.some((name) => selectors.isToolDisabledViewOnly(state, name));\n  });\n  const isOpen = useSelector((state) => selectors.isElementOpen(state, DataElements.SCALE_OVERLAY_CONTAINER));\n  const initialPosition = useSelector((state) => selectors.getScaleOverlayPosition(state));\n  const { position, handleDrag, handleStop, containerRef, setOverlayRef, initialOffset, dragBounds, resetPosition } = useDraggablePosition(initialPosition);\n  const [, forceUpdate] = useReducer((x) => x + 1, 0, () => 0);\n\n  useEffect(() => {\n    resetPosition();\n  }, [initialPosition, resetPosition]);\n\n  const updateIsCalibration = useCallback((isCalibration) => {\n    dispatch(actions.updateCalibrationInfo({ isCalibration }));\n  }, []);\n\n  const disableToolElements = useCallback((disabled) => {\n    measurementDataElements.forEach((dataElement) => {\n      dispatch(\n        actions.setCustomElementOverrides(dataElement, {\n          disabled,\n        }),\n      );\n    });\n  }, []);\n\n  const setSelectedScale = (scale) => dispatch(actions.setSelectedScale(scale));\n\n  const openScaleModal = useCallback((scale) => {\n    scale && setSelectedScale(new Scale(scale));\n    dispatch(actions.openElements([DataElements.SCALE_MODAL]));\n    dispatch(actions.setIsElementHidden(DataElements.SCALE_MODAL, false));\n  }, []);\n\n  const onScaleSelected = useCallback((selectedScales, scale) => {\n    const newScale = new Scale(scale);\n    if (selectedScales.length === 1 && selectedScales.includes(scale)) {\n      openScaleModal(scale);\n    } else {\n      const applyTo = [...annotations, selectedTool];\n      const scaleToDelete = core.getDocumentViewer().getMeasurementManager().getOldScalesToDeleteAfterApplying({ scale: newScale, applyTo })[0];\n      const createAndApplyScale = () => {\n        core.createAndApplyScale(\n          newScale,\n          [...annotations, selectedTool]\n        );\n      };\n      if (scaleToDelete) {\n        confirmScaleToDelete(scaleToDelete, createAndApplyScale);\n      } else {\n        createAndApplyScale();\n      }\n    }\n  }, [annotations, selectedTool]);\n\n  const confirmScaleToDelete = (scaleToDelete, createAndApplyScale) => {\n    const message = (\n      <div className='customMessage'>\n        <p>\n          <span>\n            {t('option.measurement.deleteScaleModal.ifChangeScale')}\n            <b>{scaleToDelete}</b>\n            {t('option.measurement.deleteScaleModal.notUsedWillDelete')}\n          </span>\n        </p>\n        <p>\n          <span>\n            {t('option.measurement.deleteScaleModal.ifToContinue')}\n          </span>\n        </p>\n      </div>\n    );\n    const title = `${t('option.measurement.deleteScaleModal.deleteScale')} ${scaleToDelete}`;\n    const confirmBtnText = t('action.confirm');\n\n    const warning = {\n      message,\n      title,\n      confirmBtnText,\n      onConfirm: () => createAndApplyScale()\n    };\n    dispatch(actions.showWarningMessage(warning));\n  };\n\n  const onCancelCalibrationMode = useCallback((previousToolName) => {\n    updateIsCalibration(false);\n    dispatch(actions.setIsElementHidden(DataElements.SCALE_MODAL, false));\n    core.setToolMode(previousToolName);\n  }, []);\n\n  const onApplyCalibration = useCallback((previousToolName, tempScale, isFractionalUnit) => {\n    dispatch(actions.updateCalibrationInfo({ isCalibration: false, tempScale, isFractionalUnit }));\n    dispatch(actions.setIsElementHidden(DataElements.SCALE_MODAL, false));\n    core.setToolMode(previousToolName);\n    core.deleteAnnotations([annotations[0]]);\n  }, [annotations]);\n\n  const onAddingNewScale = useCallback(() => {\n    dispatch(actions.setIsAddingNewScale(true));\n    openScaleModal();\n  }, []);\n\n  const isMobile = isMobileSize();\n\n  if (isDisabled || isDisabledViewOnly || areToolsDisabledViewOnly) {\n    return null;\n  }\n\n  if (isMobile) {\n    return (\n      <MobilePopupWrapper>\n        <ScaleOverlay\n          annotations={annotations}\n          selectedTool={selectedTool}\n          updateIsCalibration={updateIsCalibration}\n          disableToolElements={disableToolElements}\n          onScaleSelected={onScaleSelected}\n          onCancelCalibrationMode={onCancelCalibrationMode}\n          onApplyCalibration={onApplyCalibration}\n          onAddingNewScale={onAddingNewScale}\n          forceUpdate={forceUpdate}\n          tabIndex={0}\n        />\n      </MobilePopupWrapper>\n    );\n  } else {\n    return (\n      <Draggable\n        position={position}\n        bounds={dragBounds}\n        onDrag={handleDrag}\n        onStop={handleStop}\n        cancel={'.scale-overlay-selector, .add-new-scale'}\n      >\n        <div\n          className={classNames({\n            Overlay: true,\n            ScaleOverlay: true,\n            open: isOpen,\n            closed: !isOpen,\n          })}\n          data-element={DataElements.SCALE_OVERLAY_CONTAINER}\n          style={initialOffset}\n          ref={(node) => {\n            containerRef.current = node;\n            setOverlayRef(node);\n          }}\n        >\n          <ScaleOverlay\n            annotations={annotations}\n            selectedTool={selectedTool}\n            updateIsCalibration={updateIsCalibration}\n            disableToolElements={disableToolElements}\n            onScaleSelected={onScaleSelected}\n            onCancelCalibrationMode={onCancelCalibrationMode}\n            onApplyCalibration={onApplyCalibration}\n            onAddingNewScale={onAddingNewScale}\n            forceUpdate={forceUpdate}\n            tabIndex={0}\n          />\n        </div>\n      </Draggable>\n    );\n  }\n};\n\nScaleOverlayContainer.propTypes = propTypes;\n\nexport default ScaleOverlayContainer;\n"],"sourceRoot":""}