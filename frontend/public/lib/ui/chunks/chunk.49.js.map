{"version":3,"sources":["webpack:///./src/ui/src/components/FormulaHelperOverlay/FormulaHelperOverlay.js","webpack:///./src/ui/src/components/FormulaHelperOverlay/index.js","webpack:///./src/ui/src/components/FormulaOverlay/FormulaOverlay.js","webpack:///./src/ui/src/components/FormulaBar/FormulaBar.js","webpack:///./src/ui/src/components/FormulaBar/FormulaBarContainer.js","webpack:///./src/ui/src/components/FormulaBar/index.js"],"names":["FormulaHelperOverlay","props","_selectedFormula$para","selectedFormula","labelId","t","useTranslation","formulaLabel","name","formulaParameters","parameters","map","param","concat","React","createElement","className","aria-labelledby","join","propTypes","PropTypes","object","string","FormulaOverlay","_ref","isOpen","options","onSelect","onClose","triggerElement","highlightedIndex","setHighlightedIndex","id","overlayRef","useRef","optionRefs","useEffect","current","scrollIntoView","behavior","block","handleClickOutside","useCallback","e","contains","target","useOnClickOutside","DataElementWrapper","dataElement","DataElements","FORMULA_OVERLAY","ref","role","option","index","key","el","classNames","onClick","onMouseEnter","aria-selected","tabIndex","description","isRequired","bool","arrayOf","shape","func","instanceOf","Element","number","FormulaBar","isReadOnly","activeCellRange","cellFormula","stringCellValue","onRangeInputChange","onRangeInputKeyDown","core","useCore","formulaBarValue","_useState2","_slicedToArray","useState","inputValue","setInputValue","_useState4","showOverlay","setShowOverlay","_useState6","_useState8","setSelectedFormula","_useState0","formulaSearchResults","setFormulaSearchResults","_useState10","formulaSegments","setFormulaSegments","_useState12","isFormulaFocused","setIsFormulaFocused","formulaInputRef","formulaBarProviderRef","lastCellRef","spreadsheetEditorManager","getDocumentViewer","getSpreadsheetEditorManager","setProvider","getFormulaBarProvider","addEventListener","removeEventListener","handleFormulaSearchEvent","event","_event$getFormulaInfo","_event$getFormulaInfo2","items","getFormulaInfoItems","call","handleFormulaBarTextChanged","segments","getInfo","updatedText","segment","_text","handleFormulaBarSelectionChangedEvent","_formulaInputRef$curr","_formulaInputRef$curr2","focus","inputPosition","getSelectionPosition","setSelectionRange","handleFormulaHelpEvent","getFormulaInfo","currentCell","handleOptionSelect","onFormulaBarSelectFormula","onFormulaBarTextChange","handleOverlayClose","handleInputChange","value","onFormulaBarSelectionChanged","selectionStart","length","handleInputFocus","onFormulaBarFocus","overlayID","FORMULA_BAR","handleKeyDown","preventDefault","prev","shiftKey","stopPropagation","onFormulaBarKeyDown","type","onChange","onKeyDown","aria-label","readOnly","Icon","glyph","item","text","style","color","onFocus","aria-autocomplete","aria-expanded","aria-controls","hasFormula","aria-activedescendant","undefined","onBlur","_e$relatedTarget","relatedTarget","closest","oneOfType","EDIT_MODE","window","Core","SpreadsheetEditor","SpreadsheetEditorEditMode","FormulaBarContainer","useSelector","selectors","getActiveCellRange","getCellFormula","getStringCellValue","isReadOnlyMode","getSpreadsheetEditorEditMode","VIEW_ONLY","rangeInputValue","setRangeInputValue","spreadsheetEditorDocument","getDocument","getSpreadsheetEditorDocument","cellRange","getCellRange","selectCellRange","console","error"],"mappings":"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","file":"chunks/chunk.49.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport './FormulaHelperOverlay.scss';\n\nconst FormulaHelperOverlay = (props) => {\n  const { selectedFormula, labelId } = props;\n  const { t } = useTranslation();\n\n  const formulaLabel = selectedFormula?.name || '';\n  const formulaParameters = selectedFormula?.parameters?.map((param) =>\n    t(`formulas.${selectedFormula.name}.parameters.${param.name}.name`, param.name)\n  ) || [];\n\n  return (\n    <div className=\"FormulaHelperOverlay\" aria-labelledby={labelId}>\n      <span className=\"formulaHelperOverlayValue\">\n        {formulaLabel}({formulaParameters.join(', ')})\n      </span>\n    </div>\n  );\n};\n\nFormulaHelperOverlay.propTypes = {\n  selectedFormula: PropTypes.object,\n  labelId: PropTypes.string,\n};\n\nexport default FormulaHelperOverlay;","import FormulaHelperOverlay from './FormulaHelperOverlay';\n\nexport default FormulaHelperOverlay;","import React, { useCallback, useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport useOnClickOutside from 'hooks/useOnClickOutside';\nimport { useTranslation } from 'react-i18next';\nimport './FormulaOverlay.scss';\nimport FormulaHelperOverlay from '../FormulaHelperOverlay';\nimport DataElementWrapper from '../DataElementWrapper';\nimport DataElements from 'constants/dataElement';\n\nconst FormulaOverlay = ({\n  isOpen,\n  options,\n  onSelect,\n  onClose,\n  triggerElement,\n  highlightedIndex,\n  setHighlightedIndex,\n  selectedFormula,\n  id,\n}) => {\n  const { t } = useTranslation();\n  const overlayRef = useRef(null);\n  const optionRefs = useRef([]);\n\n  useEffect(() => {\n    if (optionRefs.current[highlightedIndex]) {\n      optionRefs.current[highlightedIndex].scrollIntoView({\n        behavior: 'smooth',\n        block: 'nearest',\n      });\n    }\n  }, [highlightedIndex]);\n\n  const handleClickOutside = useCallback((e) => {\n    if (isOpen && !triggerElement?.contains(e.target)) {\n      onClose();\n    }\n  }, [isOpen, onClose, triggerElement]);\n\n  useOnClickOutside(overlayRef, handleClickOutside);\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <DataElementWrapper dataElement={DataElements.FORMULA_OVERLAY} className=\"FormulaOverlay\">\n      <span id='formula-overlay-label' className='formula-label'>\n        {t('formulaBar.formulas')}\n      </span>\n      {!selectedFormula && (\n        <ul\n          ref={overlayRef}\n          className=\"formula-overlay-list\"\n          role=\"listbox\"\n          aria-labelledby=\"formula-overlay-label\"\n          id={id}\n        >\n          {options.map((option, index) => (\n            <li\n              key={`${option.name}-${index}`}\n              ref={(el) => (optionRefs.current[index] = el)}\n              className={classNames('formula-option', {\n                'highlighted': highlightedIndex === index,\n              })}\n              onClick={() => onSelect(option)}\n              onMouseEnter={() => setHighlightedIndex(index)}\n              id={`option-${index}`}\n              role=\"option\"\n              aria-labelledby={`formula-name-${index} formula-desc-${index}`}\n              aria-selected={highlightedIndex === index}\n              tabIndex={0}\n            >\n              <div id={`formula-name-${index}`} className=\"formula-name\">{option.name}</div>\n              {highlightedIndex === index && (\n                <div id={`formula-desc-${index}`} className=\"formula-description\">\n                  {t(`formulas.${option.name}.description`, option.description)}\n                </div>\n              )}\n            </li>\n          ))}\n        </ul>\n      )}\n      {selectedFormula && (\n        <FormulaHelperOverlay\n          selectedFormula={selectedFormula}\n          labelId=\"formula-overlay-label\"\n        />\n      )}\n    </DataElementWrapper>\n  );\n};\n\nFormulaOverlay.propTypes = {\n  id: PropTypes.string.isRequired,\n  isOpen: PropTypes.bool.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.shape({\n      name: PropTypes.string.isRequired,\n      description: PropTypes.string.isRequired,\n    })\n  ).isRequired,\n  onSelect: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  triggerElement: PropTypes.instanceOf(Element),\n  highlightedIndex: PropTypes.number.isRequired,\n  setHighlightedIndex: PropTypes.func.isRequired,\n  selectedFormula: PropTypes.shape({\n    name: PropTypes.string,\n    description: PropTypes.string.isRequired,\n    parameters: PropTypes.arrayOf(\n      PropTypes.shape({\n        name: PropTypes.string,\n      })\n    ),\n  }),\n};\n\nexport default FormulaOverlay;\n","import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { useTranslation } from 'react-i18next';\nimport Icon from 'components/Icon';\nimport DataElements from 'constants/dataElement';\nimport DataElementWrapper from 'components/DataElementWrapper';\nimport FormulaOverlay from 'components/FormulaOverlay/FormulaOverlay';\nimport useCore from 'hooks/useCore';\nimport './FormulaBar.scss';\n\nconst FormulaBar = (props) => {\n  const {\n    isReadOnly,\n    activeCellRange,\n    cellFormula,\n    stringCellValue,\n    onRangeInputChange,\n    onRangeInputKeyDown,\n  } = props;\n\n  const { t } = useTranslation();\n  const { core } = useCore();\n  const formulaBarValue = cellFormula || stringCellValue || '';\n\n  const [inputValue, setInputValue] = useState(formulaBarValue);\n  const [showOverlay, setShowOverlay] = useState(false);\n  const [highlightedIndex, setHighlightedIndex] = useState(0);\n  const [selectedFormula, setSelectedFormula] = useState(null);\n  const [formulaSearchResults, setFormulaSearchResults] = useState([]);\n  const [formulaSegments, setFormulaSegments] = useState([]);\n  const [isFormulaFocused, setIsFormulaFocused] = useState(false);\n\n  const formulaInputRef = useRef(null);\n  const formulaBarProviderRef = useRef(null);\n  const lastCellRef = useRef();\n\n  const spreadsheetEditorManager = core.getDocumentViewer().getSpreadsheetEditorManager();\n\n  useEffect(() => {\n    function setProvider() {\n      formulaBarProviderRef.current = spreadsheetEditorManager.getFormulaBarProvider();\n    }\n\n    core.addEventListener('spreadsheetEditorReady', setProvider);\n\n    return () => {\n      core.removeEventListener('spreadsheetEditorReady', setProvider);\n    };\n  }, [spreadsheetEditorManager]);\n\n  useEffect(() => {\n    const handleFormulaSearchEvent = (event) => {\n      if (!isFormulaFocused) {\n        return;\n      }\n\n      const items = event.getFormulaInfoItems?.() ?? [];\n      setFormulaSearchResults(items);\n      setHighlightedIndex(0);\n    };\n\n    core.addEventListener('formulaSearchEvent', handleFormulaSearchEvent);\n\n    return () => {\n      core.removeEventListener('formulaSearchEvent', handleFormulaSearchEvent);\n    };\n  }, [isFormulaFocused]);\n\n  useEffect(() => {\n    const handleFormulaBarTextChanged = (event) => {\n      const segments = event.getInfo();\n      setFormulaSegments(segments);\n\n      const updatedText = segments.map((segment) => segment._text).join('');\n      setInputValue(updatedText);\n    };\n\n    const handleFormulaBarSelectionChangedEvent = (event) => {\n      formulaInputRef.current?.focus();\n      const inputPosition = event.getSelectionPosition();\n      formulaInputRef.current?.setSelectionRange(inputPosition, inputPosition);\n    };\n\n    const handleFormulaHelpEvent = (event) => {\n      setSelectedFormula(event.getFormulaInfo());\n    };\n\n    core.addEventListener('formulaBarTextChangedEvent', handleFormulaBarTextChanged);\n    core.addEventListener('formulaBarSelectionChangedEvent', handleFormulaBarSelectionChangedEvent);\n    core.addEventListener('formulaHelpEvent', handleFormulaHelpEvent);\n\n    return () => {\n      core.removeEventListener('formulaBarTextChangedEvent', handleFormulaBarTextChanged);\n      core.removeEventListener('formulaBarSelectionChangedEvent', handleFormulaBarSelectionChangedEvent);\n      core.removeEventListener('formulaHelpEvent', handleFormulaHelpEvent);\n    };\n  }, []);\n\n  useEffect(() => {\n    const currentCell = activeCellRange;\n    if (lastCellRef.current !== currentCell) {\n      setInputValue(formulaBarValue);\n      lastCellRef.current = currentCell;\n    }\n  }, [activeCellRange, formulaBarValue]);\n\n  const handleOptionSelect = useCallback((option) => {\n    if (formulaBarProviderRef.current) {\n      formulaBarProviderRef.current.onFormulaBarSelectFormula(option.name);\n      formulaBarProviderRef.current.onFormulaBarTextChange(option.name);\n    }\n  }, []);\n\n  const handleOverlayClose = useCallback(() => {\n    setShowOverlay(false);\n  }, []);\n\n  const handleInputChange = useCallback((e) => {\n    const value = e.target.value;\n    setInputValue(value);\n    setFormulaSegments([]);\n    if (formulaBarProviderRef.current) {\n      formulaBarProviderRef.current.onFormulaBarSelectionChanged(formulaInputRef.current.selectionStart);\n      formulaBarProviderRef.current.onFormulaBarTextChange(value);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (formulaSearchResults.length === 0 && !selectedFormula || !isFormulaFocused) {\n      setShowOverlay(false);\n    } else {\n      setShowOverlay(true);\n    }\n  }, [formulaSearchResults, selectedFormula]);\n\n  const handleInputFocus = useCallback(() => {\n    setIsFormulaFocused(true);\n    if (formulaBarProviderRef.current) {\n      formulaBarProviderRef.current.onFormulaBarFocus();\n    }\n  }, []);\n\n  const overlayID = `formula-overlay-${DataElements.FORMULA_BAR}`;\n\n  const handleInputBlur = (e) => {\n    if (showOverlay && !e.relatedTarget?.closest(`#${overlayID}`)) {\n      handleOverlayClose();\n    }\n    setIsFormulaFocused(false);\n  };\n\n  const handleKeyDown = useCallback((e) => {\n    if (showOverlay && !isReadOnly) {\n      switch (e.key) {\n        case 'ArrowDown':\n          e.preventDefault();\n          setHighlightedIndex((prev) => (prev + 1) % formulaSearchResults.length);\n          return;\n        case 'ArrowUp':\n          e.preventDefault();\n          setHighlightedIndex((prev) => (prev - 1 + formulaSearchResults.length) % formulaSearchResults.length);\n          return;\n        case 'Enter':\n          if (formulaSearchResults[highlightedIndex]) {\n            handleOptionSelect(formulaSearchResults[highlightedIndex]);\n            return;\n          }\n          break;\n        case 'Tab':\n          if (!e.shiftKey) {\n            e.preventDefault();\n            if (formulaSearchResults[highlightedIndex]) {\n              handleOptionSelect(formulaSearchResults[highlightedIndex]);\n            }\n            return;\n          }\n          break;\n        case 'Escape':\n          e.stopPropagation();\n          handleOverlayClose();\n          return;\n        default:\n          break;\n      }\n    }\n    if (formulaBarProviderRef.current) {\n      formulaBarProviderRef.current.onFormulaBarSelectionChanged(formulaInputRef.current.selectionStart);\n      formulaBarProviderRef.current.onFormulaBarKeyDown(e);\n    }\n  }, [showOverlay, isReadOnly, formulaSearchResults, highlightedIndex, handleOptionSelect, handleOverlayClose]);\n\n  return (\n    <DataElementWrapper className='FormulaBar' dataElement={DataElements.FORMULA_BAR}>\n      <input\n        type=\"text\"\n        className='RangeInput'\n        value={activeCellRange}\n        onChange={(e) => onRangeInputChange(e.target.value)}\n        onKeyDown={onRangeInputKeyDown}\n        aria-label={t('formulaBar.range')}\n      />\n      <div className={classNames('Formula', { readOnly: isReadOnly })}>\n        <Icon glyph=\"function\" className={classNames('FormulaIcon', { readOnly: isReadOnly })} />\n        <div className='FormulaInputMask'>\n          {\n            formulaSegments.map((item, index) => {\n              return (<span key={`${item.text}-${index}`} style={{ color: item.color }}>{item.text}</span>);\n            })\n          }\n        </div>\n        <input\n          onFocus={handleInputFocus}\n          id={DataElements.FORMULA_BAR}\n          ref={formulaInputRef}\n          type=\"text\"\n          role=\"combobox\"\n          aria-autocomplete=\"list\"\n          aria-expanded={formulaSearchResults.length > 0}\n          aria-controls={overlayID}\n          className={classNames({\n            'FormulaInput': true,\n            hasFormula: formulaSegments.length > 0,\n          })}\n          aria-activedescendant={showOverlay && highlightedIndex !== -1 ? `option-${highlightedIndex}` : undefined}\n          value={inputValue}\n          onChange={handleInputChange}\n          onBlur={handleInputBlur}\n          onKeyDown={handleKeyDown}\n          readOnly={isReadOnly}\n          aria-label={t('formulaBar.label')}\n        />\n        {showOverlay && !isReadOnly && (\n          <FormulaOverlay\n            isOpen={showOverlay}\n            options={formulaSearchResults}\n            onSelect={handleOptionSelect}\n            onClose={handleOverlayClose}\n            triggerElement={formulaInputRef.current}\n            highlightedIndex={highlightedIndex}\n            setHighlightedIndex={setHighlightedIndex}\n            selectedFormula={selectedFormula}\n            id={overlayID}\n          />\n        )}\n      </div>\n    </DataElementWrapper>\n  );\n};\n\nFormulaBar.propTypes = {\n  isReadOnly: PropTypes.bool,\n  activeCellRange: PropTypes.string,\n  cellFormula: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  stringCellValue: PropTypes.string,\n  onRangeInputChange: PropTypes.func,\n  onRangeInputKeyDown: PropTypes.func,\n};\n\nexport default FormulaBar;\n","import React, { useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport selectors from 'selectors';\nimport FormulaBar from './FormulaBar';\nimport useCore from 'hooks/useCore';\n\nconst EDIT_MODE = window.Core.SpreadsheetEditor.SpreadsheetEditorEditMode;\n\nexport const FormulaBarContainer = () => {\n  // This component can pull all Redux state and call any core methods\n  const activeCellRange = useSelector(selectors.getActiveCellRange);\n  const cellFormula = useSelector(selectors.getCellFormula);\n  const stringCellValue = useSelector(selectors.getStringCellValue);\n  const spreadsheetEditorEditMode = useSelector(selectors.getSpreadsheetEditorEditMode);\n  const isReadOnlyMode = spreadsheetEditorEditMode === EDIT_MODE.VIEW_ONLY;\n\n  const { core } = useCore();\n  const [rangeInputValue, setRangeInputValue] = useState(activeCellRange);\n\n  const onRangeInputChange = (value) => {\n    setRangeInputValue(value);\n  };\n\n  const onRangeInputKeyDown = (event) => {\n    if (event.key === 'Enter') {\n      try {\n        const documentViewer = core.getDocumentViewer();\n        const spreadsheetEditorDocument = documentViewer.getDocument().getSpreadsheetEditorDocument();\n        const cellRange = core.getCellRange(event.target.value);\n        spreadsheetEditorDocument.selectCellRange(cellRange);\n      } catch (e) {\n        setRangeInputValue(activeCellRange);\n        console.error(e);\n        return;\n      }\n    }\n  };\n\n  useEffect(() => {\n    setRangeInputValue(activeCellRange);\n  }, [activeCellRange]);\n\n  return (\n    <FormulaBar\n      isReadOnly={isReadOnlyMode}\n      activeCellRange={rangeInputValue}\n      cellFormula={cellFormula}\n      stringCellValue={stringCellValue}\n      onRangeInputChange={onRangeInputChange}\n      onRangeInputKeyDown={onRangeInputKeyDown}\n    />\n  );\n};\n\nexport default FormulaBarContainer;","import FormulaBarContainer from './FormulaBarContainer';\nexport default FormulaBarContainer;"],"sourceRoot":""}