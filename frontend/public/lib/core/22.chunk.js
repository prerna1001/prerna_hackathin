/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[22],{722:function(wa,ua,e){e.r(ua);var ja=e(0),oa=e(7),la=e(2);wa=e(50);var ia=e(38),ca=e(21);e=function(){function ba(){this.init()}ba.prototype.init=function(){this.ACa=!1;this.Zh=this.Zq=this.connection=null;this.ll={};this.ga=this.kU=null};ba.prototype.wE=function(y){for(var x=this,r=0;r<y.length;++r){var f=y[r];switch(f.at){case "create":this.ll[f.author]||(this.ll[f.author]=f.aName);this.CQa(f);break;case "modify":this.ga.Vu(f.xfdf).then(function(n){x.ga.Jb(n[0])});
break;case "delete":f="<delete><id>".concat(f.aId,"</id></delete>"),this.ga.Vu(f)}}};ba.prototype.CQa=function(y){var x=this;this.ga.Vu(y.xfdf).then(function(r){r=r[0];r.authorId=y.author;x.ga.Jb(r);x.ga.trigger(oa.d.UPDATE_ANNOTATION_PERMISSION,[r])})};ba.prototype.XOa=function(y,x,r){this.Zq&&this.Zq(y,x,r)};ba.prototype.preloadAnnotations=function(y){this.addEventListener("webViewerServerAnnotationsEnabled",this.XOa.bind(this,y,"add",{imported:!1}),{once:!0})};ba.prototype.initiateCollaboration=
function(y,x,r){var f=this;if(y){f.Zh=x;f.ga=r.ja();r.addEventListener(oa.i.DOCUMENT_UNLOADED,function(){f.disableCollaboration()});f.W7a(y);var n=new XMLHttpRequest;n.addEventListener("load",function(){if(200===n.status&&0<n.responseText.length)try{var b=JSON.parse(n.responseText);f.connection=exports.da.A9a(Object(ia.l)(f.Zh,"blackbox/"),"annot");f.kU=b.id;f.ll[b.id]=b.user_name;f.ga.f5(b.id);f.connection.Qcb(function(h){h.t&&h.t.startsWith("a_")&&h.data&&f.wE(h.data)},function(){f.connection.send({t:"a_retrieve",
dId:y});f.trigger(ba.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[f.ll[b.id],f.kU])},function(){f.disableCollaboration()})}catch(h){Object(la.g)(h.message)}});n.open("GET",Object(ia.l)(this.Zh,"demo/SessionInfo.jsp"));n.withCredentials=!0;n.send();f.ACa=!0;f.ga.Rna(function(b){return f.ll[b.Author]||b.Author})}else Object(la.g)("Document ID required for collaboration")};ba.prototype.disableCollaboration=function(){this.Zq&&(this.ga.removeEventListener(ca.a.Events.ANNOTATION_CHANGED,this.Zq),this.Zq=
null);this.connection&&this.connection.wx();this.ga&&this.ga.f5("Guest");this.init();this.trigger(ba.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ba.prototype.W7a=function(y){var x=this;this.Zq&&this.ga.removeEventListener(ca.a.Events.ANNOTATION_CHANGED,this.Zq);this.Zq=function(r,f,n){return Object(ja.c)(this,void 0,void 0,function(){var b,h,a,w,aa,z,ea,ha,na;return Object(ja.e)(this,function(fa){switch(fa.label){case 0:if(n.imported)return[2];b={t:"a_".concat(f),dId:y,annots:[]};return[4,x.ga.fea()];
case 1:h=fa.aa();"delete"!==f&&(a=(new DOMParser).parseFromString(h,"text/xml"),w=new XMLSerializer);for(aa=0;aa<r.length;aa++)z=r[aa],ha=ea=void 0,"add"===f?(ea=a.querySelector('[name="'.concat(z.Id,'"]')),ha=w.serializeToString(ea),na=null,z.InReplyTo&&(na=x.ga.Kf(z.InReplyTo).authorId||"default"),b.annots.push({at:"create",aId:z.Id,author:x.kU,aName:x.ll[x.kU],parent:na,xfdf:"<add>".concat(ha,"</add>")})):"modify"===f?(ea=a.querySelector('[name="'.concat(z.Id,'"]')),ha=w.serializeToString(ea),
b.annots.push({at:"modify",aId:z.Id,xfdf:"<modify>".concat(ha,"</modify>")})):"delete"===f&&b.annots.push({at:"delete",aId:z.Id});0<b.annots.length&&x.connection.send(b);return[2]}})})}.bind(x);this.ga.addEventListener(ca.a.Events.ANNOTATION_CHANGED,this.Zq)};ba.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ba}();Object(wa.b)(e);ua["default"]=e}}]);}).call(this || window)
